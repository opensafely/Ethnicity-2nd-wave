------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/lsh152058/Documents/GitHub/Ethnicity-2nd-wave/logs/01_eth_cr_ana
> lysis_dataset.log
  log type:  text
 opened on:  21 Jan 2021, 11:36:02

. 
. clear

. import delimited ./output/input.csv
(80 vars, 100,000 obs)

. 
. global outcomes "tested positivetest hes icu onscoviddeath ons_noncoviddeath onsde
> ath"

. 
. ****************************
. *  Create required cohort  *
. ****************************
. 
. /* DROP ALL KIDS */
. noi di "DROPPING AGE<18:" 
DROPPING AGE<18:

. drop if age<18
(20,918 observations deleted)

. safecount
  79,082

. 
. * Age: Exclude those with implausible ages
. cap assert age<.

. noi di "DROPPING AGE<105:" 
DROPPING AGE<105:

. drop if age>105
(22 observations deleted)

. safecount
  79,060

. 
. * Sex: Exclude categories other than M and F
. cap assert inlist(sex, "M", "F", "I", "U")

. noi di "DROPPING GENDER NOT M/F:" 
DROPPING GENDER NOT M/F:

. drop if inlist(sex, "I", "U")
(0 observations deleted)

. 
. gen male = 1 if sex == "M"
(40,162 missing values generated)

. replace male = 0 if sex == "F"
(40,162 real changes made)

. label define male 0"Female" 1"Male"

. label values male male

. safetab male

       male |      Freq.     Percent        Cum.
------------+-----------------------------------
     Female |     40,162       50.80       50.80
       Male |     38,898       49.20      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. safecount
  79,060

. 
. /*  IMD  */
. * Group into 5 groups
. rename imd imd_o

. egen imd = cut(imd_o), group(5) icodes

. 
. * add one to create groups 1 - 5 
. replace imd = imd + 1
(79,060 real changes made)

. 
. * - 1 is missing, should be excluded from population 
. replace imd = .u if imd_o == -1
(0 real changes made)

. drop imd_o

. 
. * Reverse the order (so high is more deprived)
. recode imd 5 = 1 4 = 2 3 = 3 2 = 4 1 = 5 .u = .u
(imd: 79060 changes made)

. 
. label define imd 1 "1 least deprived" 2 "2" 3 "3" 4 "4" 5 "5 most deprived" .u "Un
> known"

. label values imd imd 

. safetab imd, m

             imd |      Freq.     Percent        Cum.
-----------------+-----------------------------------
1 least deprived |     55,402       70.08       70.08
               4 |     15,803       19.99       90.06
 5 most deprived |      7,855        9.94      100.00
-----------------+-----------------------------------
           Total |     79,060      100.00

. 
. drop if imd==.u
(0 observations deleted)

. safecount
  79,060

. 
. 
. * Create restricted cubic splines for age
. mkspline age = age, cubic nknots(4)

. 
. *Start dates
. gen index                       = "01/02/2020"

. 
. * Date of cohort entry, 1 Feb 2020
. gen indexdate = date(index, "DMY")

. format indexdate %d

. 
. 
. *******************************************************************************
. 
. 
. 
. /* CREATE VARIABLES===========================================================*/
. 
. /* OUTCOME AND SURVIVAL TIME==================================================*/
. 
. /****   Outcome definitions   ****/
. ren primary_care_suspect_case   suspected_date

. ren primary_care_case                   confirmed_date

. ren first_tested_for_covid              tested_date

. ren first_positive_test_date    positivetest_date

. ren a_e_consult_date                    ae_date

. ren icu_date_admitted                   icu_date

. ren died_date_cpns                              cpnsdeath_date

. ren died_date_ons                               onsdeath_date

. ren covid_admission_date                hes_date

. 
. * Date of Covid death in ONS
. gen onscoviddeath_date = onsdeath_date if died_ons_covid_flag_any == 1
(74,165 missing values generated)

. gen onsconfirmeddeath_date = onsdeath_date if died_ons_confirmedcovid_flag_any ==1
(74,174 missing values generated)

. gen onssuspecteddeath_date = onsdeath_date if died_ons_suspectedcovid_flag_any ==1
(74,153 missing values generated)

. 
. * Date of non-COVID death in ONS 
. * If missing date of death resulting died_date will also be missing
. gen ons_noncoviddeath_date = onsdeath_date if died_ons_covid_flag_any != 1
(64,249 missing values generated)

. 
. 
. /* CONVERT STRINGS TO DATE FOR OUTCOME VARIABLES =============================*/
. * Recode to dates from the strings 
. *gen dummy date for infected and replace later on
. 
. foreach var of global outcomes {
  2.         d `var_date'
  3.         safetab `var'_date
  4.         confirm string variable `var'_date
  5.         rename `var'_date `var'_dstr
  6.         gen `var'_date = date(`var'_dstr, "YMD")
  7.         drop `var'_dstr
  8.         format `var'_date %td 
  9. 
. }

Contains data
  obs:        79,060                          
 vars:            90                          
------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
dereg_date      str7    %9s                   
confirmed_date  str10   %10s                  
primary_care~se str10   %10s                  
primary_care~re str10   %10s                  
suspected_date  str10   %10s                  
ae_date         str10   %10s                  
hes_date        str10   %10s                  
icu_date        str10   %10s                  
cpnsdeath_date  str10   %10s                  
onsdeath_date   str10   %10s                  
tested_date     str10   %10s                  
positivetest_~e str10   %10s                  
ethnicity_16_~e int     %8.0g                 
ethnicity_date  int     %8.0g                 
bmi_date_meas~d str7    %9s                   
bp_sys_date_m~d str7    %9s                   
bp_dias_date_~d str7    %9s                   
hba1c_mmol_pe~e str7    %9s                   
hba1c_percen~te str7    %9s                   
creatinine_date str7    %9s                   
smoking_statu~e str7    %9s                   
chronic_respi~e str7    %9s                   
chronic_cardi~e str7    %9s                   
type1_diabetes  str7    %9s                   
type2_diabetes  str7    %9s                   
unknown_diabe~s str7    %9s                   
cancer          str7    %9s                   
permanent_imm~y str7    %9s                   
temporary_imm~y str7    %9s                   
chronic_liver~e str7    %9s                   
other_neuro     str7    %9s                   
stroke          str7    %9s                   
dementia        str7    %9s                   
esrf            str7    %9s                   
hypertension    str7    %9s                   
ra_sle_psoria~s str7    %9s                   
insulin         str7    %9s                   
statin          str7    %9s                   
any_resp_supp~g byte    %8.0g                 
basic_resp_su~g byte    %8.0g                 
advanced_resp~g byte    %8.0g                 
covid_admissi~i str4    %9s                   covid_admission_primary_diagnosis
died_ons_covi~y byte    %8.0g                 
died_ons_conf~y byte    %8.0g                 
died_ons_susp~y byte    %8.0g                 
died_ons_covi~g byte    %8.0g                 
age             int     %8.0g                 
sex             str1    %9s                   
rural_urban     str5    %9s                   
stp             str5    %9s                   
region          str24   %24s                  
ethnicity_16    byte    %8.0g                 
ethnicity       byte    %8.0g                 
care_home_type  str2    %9s                   
hh_id           int     %8.0g                 
hh_size         byte    %8.0g                 
is_prison       byte    %8.0g                 
gp_consult_co~t byte    %8.0g                 
has_consultat~y byte    %8.0g                 
bmi             float   %9.0g                 
bp_sys          float   %9.0g                 
bp_dias         float   %9.0g                 
hba1c_mmol_pe~l float   %9.0g                 
hba1c_percen~ge float   %9.0g                 
creatinine      float   %9.0g                 
smoking_status  str1    %9s                   
asthma          byte    %8.0g                 
diabetes_type   str10   %10s                  
diabetes_exet~s str10   %10s                  
diabetes_exeter str7    %9s                   
ace_inhibitors  byte    %8.0g                 
alpha_blockers  byte    %8.0g                 
arbs            byte    %8.0g                 
betablockers    byte    %8.0g                 
calcium_chann~s byte    %8.0g                 
combination_b~s byte    %8.0g                 
spironolactone  byte    %8.0g                 
thiazide_diur~s byte    %8.0g                 
patient_id      long    %12.0g                
male            float   %9.0g      male       
imd             float   %16.0g     imd        
age1            float   %9.0g                 
age2            float   %9.0g                 
age3            float   %9.0g                 
index           str10   %10s                  
indexdate       float   %d                    
onscoviddeath~e str10   %10s                  
onsconfirmedd~e str10   %10s                  
onssuspectedd~e str10   %10s                  
ons_noncovidd~e str10   %10s                  
------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

tested_date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2020-09-02 |        423        0.67        0.67
 2020-09-03 |        432        0.68        1.35
 2020-09-04 |        450        0.71        2.06
 2020-09-05 |        440        0.70        2.76
 2020-09-06 |        464        0.73        3.49
 2020-09-07 |        449        0.71        4.20
 2020-09-08 |        417        0.66        4.86
 2020-09-09 |        461        0.73        5.59
 2020-09-10 |        457        0.72        6.31
 2020-09-11 |        428        0.68        6.99
 2020-09-12 |        418        0.66        7.65
 2020-09-13 |        476        0.75        8.40
 2020-09-14 |        432        0.68        9.08
 2020-09-15 |        474        0.75        9.83
 2020-09-16 |        475        0.75       10.58
 2020-09-17 |        458        0.72       11.30
 2020-09-18 |        465        0.73       12.04
 2020-09-19 |        450        0.71       12.75
 2020-09-20 |        473        0.75       13.50
 2020-09-21 |        461        0.73       14.23
 2020-09-22 |        453        0.72       14.94
 2020-09-23 |        448        0.71       15.65
 2020-09-24 |        454        0.72       16.37
 2020-09-25 |        477        0.75       17.12
 2020-09-26 |        488        0.77       17.89
 2020-09-27 |        425        0.67       18.56
 2020-09-28 |        480        0.76       19.32
 2020-09-29 |        468        0.74       20.06
 2020-09-30 |        492        0.78       20.84
 2020-10-01 |        403        0.64       21.48
 2020-10-02 |        461        0.73       22.20
 2020-10-03 |        456        0.72       22.92
 2020-10-04 |        457        0.72       23.65
 2020-10-05 |        493        0.78       24.43
 2020-10-06 |        438        0.69       25.12
 2020-10-07 |        470        0.74       25.86
 2020-10-08 |        458        0.72       26.58
 2020-10-09 |        459        0.73       27.31
 2020-10-10 |        433        0.68       27.99
 2020-10-11 |        452        0.71       28.71
 2020-10-12 |        467        0.74       29.45
 2020-10-13 |        452        0.71       30.16
 2020-10-14 |        454        0.72       30.88
 2020-10-15 |        470        0.74       31.62
 2020-10-16 |        427        0.67       32.30
 2020-10-17 |        454        0.72       33.01
 2020-10-18 |        432        0.68       33.70
 2020-10-19 |        428        0.68       34.37
 2020-10-20 |        465        0.73       35.11
 2020-10-21 |        495        0.78       35.89
 2020-10-22 |        458        0.72       36.61
 2020-10-23 |        522        0.82       37.44
 2020-10-24 |        445        0.70       38.14
 2020-10-25 |        438        0.69       38.83
 2020-10-26 |        428        0.68       39.51
 2020-10-27 |        445        0.70       40.21
 2020-10-28 |        465        0.73       40.95
 2020-10-29 |        492        0.78       41.72
 2020-10-30 |        516        0.82       42.54
 2020-10-31 |        432        0.68       43.22
 2020-11-01 |        462        0.73       43.95
 2020-11-02 |        463        0.73       44.68
 2020-11-03 |        477        0.75       45.44
 2020-11-04 |        444        0.70       46.14
 2020-11-05 |        431        0.68       46.82
 2020-11-06 |        434        0.69       47.51
 2020-11-07 |        451        0.71       48.22
 2020-11-08 |        432        0.68       48.90
 2020-11-09 |        428        0.68       49.58
 2020-11-10 |        407        0.64       50.22
 2020-11-11 |        449        0.71       50.93
 2020-11-12 |        422        0.67       51.60
 2020-11-13 |        481        0.76       52.36
 2020-11-14 |        454        0.72       53.07
 2020-11-15 |        452        0.71       53.79
 2020-11-16 |        473        0.75       54.54
 2020-11-17 |        457        0.72       55.26
 2020-11-18 |        471        0.74       56.00
 2020-11-19 |        443        0.70       56.70
 2020-11-20 |        475        0.75       57.45
 2020-11-21 |        443        0.70       58.15
 2020-11-22 |        462        0.73       58.88
 2020-11-23 |        478        0.76       59.64
 2020-11-24 |        451        0.71       60.35
 2020-11-25 |        478        0.76       61.11
 2020-11-26 |        485        0.77       61.87
 2020-11-27 |        430        0.68       62.55
 2020-11-28 |        453        0.72       63.27
 2020-11-29 |        458        0.72       63.99
 2020-11-30 |        447        0.71       64.70
 2020-12-01 |        495        0.78       65.48
 2020-12-02 |        470        0.74       66.22
 2020-12-03 |        418        0.66       66.88
 2020-12-04 |        453        0.72       67.60
 2020-12-05 |        481        0.76       68.36
 2020-12-06 |        464        0.73       69.09
 2020-12-07 |        467        0.74       69.83
 2020-12-08 |        455        0.72       70.55
 2020-12-09 |        427        0.67       71.22
 2020-12-10 |        442        0.70       71.92
 2020-12-11 |        454        0.72       72.64
 2020-12-12 |        469        0.74       73.38
 2020-12-13 |        471        0.74       74.12
 2020-12-14 |        476        0.75       74.88
 2020-12-15 |        448        0.71       75.59
 2020-12-16 |        425        0.67       76.26
 2020-12-17 |        451        0.71       76.97
 2020-12-18 |        420        0.66       77.63
 2020-12-19 |        461        0.73       78.36
 2020-12-20 |        464        0.73       79.09
 2020-12-21 |        428        0.68       79.77
 2020-12-22 |        497        0.79       80.56
 2020-12-23 |        488        0.77       81.33
 2020-12-24 |        482        0.76       82.09
 2020-12-25 |        433        0.68       82.77
 2020-12-26 |        430        0.68       83.45
 2020-12-27 |        444        0.70       84.15
 2020-12-28 |        416        0.66       84.81
 2020-12-29 |        486        0.77       85.58
 2020-12-30 |        405        0.64       86.22
 2020-12-31 |        452        0.71       86.93
 2021-01-01 |        437        0.69       87.62
 2021-01-02 |        462        0.73       88.35
 2021-01-03 |        462        0.73       89.08
 2021-01-04 |        481        0.76       89.84
 2021-01-05 |        500        0.79       90.63
 2021-01-06 |        460        0.73       91.36
 2021-01-07 |        476        0.75       92.11
 2021-01-08 |        456        0.72       92.83
 2021-01-09 |        463        0.73       93.57
 2021-01-10 |        433        0.68       94.25
 2021-01-11 |        434        0.69       94.94
 2021-01-12 |        466        0.74       95.67
 2021-01-13 |        463        0.73       96.40
 2021-01-14 |        473        0.75       97.15
 2021-01-15 |        474        0.75       97.90
 2021-01-16 |        432        0.68       98.58
 2021-01-17 |        438        0.69       99.27
 2021-01-18 |        459        0.73      100.00
------------+-----------------------------------
      Total |     63,285      100.00
(15,775 missing values generated)

Contains data
  obs:        79,060                          
 vars:            90                          
------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
dereg_date      str7    %9s                   
confirmed_date  str10   %10s                  
primary_care~se str10   %10s                  
primary_care~re str10   %10s                  
suspected_date  str10   %10s                  
ae_date         str10   %10s                  
hes_date        str10   %10s                  
icu_date        str10   %10s                  
cpnsdeath_date  str10   %10s                  
onsdeath_date   str10   %10s                  
positivetest_~e str10   %10s                  
ethnicity_16_~e int     %8.0g                 
ethnicity_date  int     %8.0g                 
bmi_date_meas~d str7    %9s                   
bp_sys_date_m~d str7    %9s                   
bp_dias_date_~d str7    %9s                   
hba1c_mmol_pe~e str7    %9s                   
hba1c_percen~te str7    %9s                   
creatinine_date str7    %9s                   
smoking_statu~e str7    %9s                   
chronic_respi~e str7    %9s                   
chronic_cardi~e str7    %9s                   
type1_diabetes  str7    %9s                   
type2_diabetes  str7    %9s                   
unknown_diabe~s str7    %9s                   
cancer          str7    %9s                   
permanent_imm~y str7    %9s                   
temporary_imm~y str7    %9s                   
chronic_liver~e str7    %9s                   
other_neuro     str7    %9s                   
stroke          str7    %9s                   
dementia        str7    %9s                   
esrf            str7    %9s                   
hypertension    str7    %9s                   
ra_sle_psoria~s str7    %9s                   
insulin         str7    %9s                   
statin          str7    %9s                   
any_resp_supp~g byte    %8.0g                 
basic_resp_su~g byte    %8.0g                 
advanced_resp~g byte    %8.0g                 
covid_admissi~i str4    %9s                   covid_admission_primary_diagnosis
died_ons_covi~y byte    %8.0g                 
died_ons_conf~y byte    %8.0g                 
died_ons_susp~y byte    %8.0g                 
died_ons_covi~g byte    %8.0g                 
age             int     %8.0g                 
sex             str1    %9s                   
rural_urban     str5    %9s                   
stp             str5    %9s                   
region          str24   %24s                  
ethnicity_16    byte    %8.0g                 
ethnicity       byte    %8.0g                 
care_home_type  str2    %9s                   
hh_id           int     %8.0g                 
hh_size         byte    %8.0g                 
is_prison       byte    %8.0g                 
gp_consult_co~t byte    %8.0g                 
has_consultat~y byte    %8.0g                 
bmi             float   %9.0g                 
bp_sys          float   %9.0g                 
bp_dias         float   %9.0g                 
hba1c_mmol_pe~l float   %9.0g                 
hba1c_percen~ge float   %9.0g                 
creatinine      float   %9.0g                 
smoking_status  str1    %9s                   
asthma          byte    %8.0g                 
diabetes_type   str10   %10s                  
diabetes_exet~s str10   %10s                  
diabetes_exeter str7    %9s                   
ace_inhibitors  byte    %8.0g                 
alpha_blockers  byte    %8.0g                 
arbs            byte    %8.0g                 
betablockers    byte    %8.0g                 
calcium_chann~s byte    %8.0g                 
combination_b~s byte    %8.0g                 
spironolactone  byte    %8.0g                 
thiazide_diur~s byte    %8.0g                 
patient_id      long    %12.0g                
male            float   %9.0g      male       
imd             float   %16.0g     imd        
age1            float   %9.0g                 
age2            float   %9.0g                 
age3            float   %9.0g                 
index           str10   %10s                  
indexdate       float   %d                    
onscoviddeath~e str10   %10s                  
onsconfirmedd~e str10   %10s                  
onssuspectedd~e str10   %10s                  
ons_noncovidd~e str10   %10s                  
tested_date     float   %td                   
------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

positivetes |
     t_date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2020-09-02 |        459        0.73        0.73
 2020-09-03 |        449        0.71        1.44
 2020-09-04 |        445        0.70        2.14
 2020-09-05 |        441        0.70        2.84
 2020-09-06 |        450        0.71        3.55
 2020-09-07 |        468        0.74        4.29
 2020-09-08 |        436        0.69        4.98
 2020-09-09 |        435        0.69        5.67
 2020-09-10 |        452        0.72        6.38
 2020-09-11 |        448        0.71        7.09
 2020-09-12 |        439        0.69        7.79
 2020-09-13 |        472        0.75        8.53
 2020-09-14 |        494        0.78        9.31
 2020-09-15 |        464        0.73       10.05
 2020-09-16 |        479        0.76       10.81
 2020-09-17 |        432        0.68       11.49
 2020-09-18 |        458        0.72       12.21
 2020-09-19 |        451        0.71       12.93
 2020-09-20 |        444        0.70       13.63
 2020-09-21 |        451        0.71       14.34
 2020-09-22 |        468        0.74       15.08
 2020-09-23 |        446        0.71       15.79
 2020-09-24 |        427        0.68       16.46
 2020-09-25 |        462        0.73       17.20
 2020-09-26 |        395        0.62       17.82
 2020-09-27 |        483        0.76       18.58
 2020-09-28 |        478        0.76       19.34
 2020-09-29 |        468        0.74       20.08
 2020-09-30 |        425        0.67       20.75
 2020-10-01 |        446        0.71       21.46
 2020-10-02 |        448        0.71       22.17
 2020-10-03 |        470        0.74       22.91
 2020-10-04 |        462        0.73       23.64
 2020-10-05 |        453        0.72       24.36
 2020-10-06 |        459        0.73       25.08
 2020-10-07 |        470        0.74       25.83
 2020-10-08 |        453        0.72       26.54
 2020-10-09 |        476        0.75       27.30
 2020-10-10 |        483        0.76       28.06
 2020-10-11 |        459        0.73       28.79
 2020-10-12 |        479        0.76       29.55
 2020-10-13 |        464        0.73       30.28
 2020-10-14 |        465        0.74       31.01
 2020-10-15 |        476        0.75       31.77
 2020-10-16 |        462        0.73       32.50
 2020-10-17 |        492        0.78       33.28
 2020-10-18 |        453        0.72       33.99
 2020-10-19 |        450        0.71       34.71
 2020-10-20 |        454        0.72       35.42
 2020-10-21 |        442        0.70       36.12
 2020-10-22 |        464        0.73       36.86
 2020-10-23 |        468        0.74       37.60
 2020-10-24 |        429        0.68       38.28
 2020-10-25 |        413        0.65       38.93
 2020-10-26 |        405        0.64       39.57
 2020-10-27 |        433        0.68       40.25
 2020-10-28 |        459        0.73       40.98
 2020-10-29 |        465        0.74       41.72
 2020-10-30 |        447        0.71       42.42
 2020-10-31 |        481        0.76       43.18
 2020-11-01 |        454        0.72       43.90
 2020-11-02 |        456        0.72       44.62
 2020-11-03 |        491        0.78       45.40
 2020-11-04 |        438        0.69       46.09
 2020-11-05 |        470        0.74       46.84
 2020-11-06 |        501        0.79       47.63
 2020-11-07 |        460        0.73       48.36
 2020-11-08 |        452        0.72       49.07
 2020-11-09 |        456        0.72       49.79
 2020-11-10 |        466        0.74       50.53
 2020-11-11 |        487        0.77       51.30
 2020-11-12 |        438        0.69       51.99
 2020-11-13 |        437        0.69       52.69
 2020-11-14 |        468        0.74       53.43
 2020-11-15 |        452        0.72       54.14
 2020-11-16 |        454        0.72       54.86
 2020-11-17 |        445        0.70       55.56
 2020-11-18 |        435        0.69       56.25
 2020-11-19 |        480        0.76       57.01
 2020-11-20 |        449        0.71       57.72
 2020-11-21 |        458        0.72       58.44
 2020-11-22 |        454        0.72       59.16
 2020-11-23 |        431        0.68       59.84
 2020-11-24 |        473        0.75       60.59
 2020-11-25 |        460        0.73       61.32
 2020-11-26 |        468        0.74       62.06
 2020-11-27 |        438        0.69       62.75
 2020-11-28 |        449        0.71       63.46
 2020-11-29 |        468        0.74       64.20
 2020-11-30 |        407        0.64       64.85
 2020-12-01 |        468        0.74       65.59
 2020-12-02 |        485        0.77       66.36
 2020-12-03 |        475        0.75       67.11
 2020-12-04 |        464        0.73       67.84
 2020-12-05 |        453        0.72       68.56
 2020-12-06 |        455        0.72       69.28
 2020-12-07 |        467        0.74       70.02
 2020-12-08 |        443        0.70       70.72
 2020-12-09 |        443        0.70       71.42
 2020-12-10 |        504        0.80       72.22
 2020-12-11 |        431        0.68       72.90
 2020-12-12 |        426        0.67       73.57
 2020-12-13 |        453        0.72       74.29
 2020-12-14 |        424        0.67       74.96
 2020-12-15 |        438        0.69       75.65
 2020-12-16 |        462        0.73       76.38
 2020-12-17 |        445        0.70       77.09
 2020-12-18 |        429        0.68       77.76
 2020-12-19 |        496        0.78       78.55
 2020-12-20 |        460        0.73       79.28
 2020-12-21 |        434        0.69       79.96
 2020-12-22 |        455        0.72       80.68
 2020-12-23 |        450        0.71       81.40
 2020-12-24 |        484        0.77       82.16
 2020-12-25 |        406        0.64       82.80
 2020-12-26 |        480        0.76       83.56
 2020-12-27 |        445        0.70       84.27
 2020-12-28 |        458        0.72       84.99
 2020-12-29 |        439        0.69       85.69
 2020-12-30 |        457        0.72       86.41
 2020-12-31 |        442        0.70       87.11
 2021-01-01 |        432        0.68       87.79
 2021-01-02 |        463        0.73       88.52
 2021-01-03 |        462        0.73       89.25
 2021-01-04 |        443        0.70       89.95
 2021-01-05 |        448        0.71       90.66
 2021-01-06 |        450        0.71       91.38
 2021-01-07 |        453        0.72       92.09
 2021-01-08 |        449        0.71       92.80
 2021-01-09 |        474        0.75       93.55
 2021-01-10 |        462        0.73       94.28
 2021-01-11 |        432        0.68       94.97
 2021-01-12 |        442        0.70       95.67
 2021-01-13 |        453        0.72       96.38
 2021-01-14 |        430        0.68       97.06
 2021-01-15 |        488        0.77       97.83
 2021-01-16 |        470        0.74       98.58
 2021-01-17 |        467        0.74       99.32
 2021-01-18 |        432        0.68      100.00
------------+-----------------------------------
      Total |     63,215      100.00
(15,845 missing values generated)

Contains data
  obs:        79,060                          
 vars:            90                          
------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
dereg_date      str7    %9s                   
confirmed_date  str10   %10s                  
primary_care~se str10   %10s                  
primary_care~re str10   %10s                  
suspected_date  str10   %10s                  
ae_date         str10   %10s                  
hes_date        str10   %10s                  
icu_date        str10   %10s                  
cpnsdeath_date  str10   %10s                  
onsdeath_date   str10   %10s                  
ethnicity_16_~e int     %8.0g                 
ethnicity_date  int     %8.0g                 
bmi_date_meas~d str7    %9s                   
bp_sys_date_m~d str7    %9s                   
bp_dias_date_~d str7    %9s                   
hba1c_mmol_pe~e str7    %9s                   
hba1c_percen~te str7    %9s                   
creatinine_date str7    %9s                   
smoking_statu~e str7    %9s                   
chronic_respi~e str7    %9s                   
chronic_cardi~e str7    %9s                   
type1_diabetes  str7    %9s                   
type2_diabetes  str7    %9s                   
unknown_diabe~s str7    %9s                   
cancer          str7    %9s                   
permanent_imm~y str7    %9s                   
temporary_imm~y str7    %9s                   
chronic_liver~e str7    %9s                   
other_neuro     str7    %9s                   
stroke          str7    %9s                   
dementia        str7    %9s                   
esrf            str7    %9s                   
hypertension    str7    %9s                   
ra_sle_psoria~s str7    %9s                   
insulin         str7    %9s                   
statin          str7    %9s                   
any_resp_supp~g byte    %8.0g                 
basic_resp_su~g byte    %8.0g                 
advanced_resp~g byte    %8.0g                 
covid_admissi~i str4    %9s                   covid_admission_primary_diagnosis
died_ons_covi~y byte    %8.0g                 
died_ons_conf~y byte    %8.0g                 
died_ons_susp~y byte    %8.0g                 
died_ons_covi~g byte    %8.0g                 
age             int     %8.0g                 
sex             str1    %9s                   
rural_urban     str5    %9s                   
stp             str5    %9s                   
region          str24   %24s                  
ethnicity_16    byte    %8.0g                 
ethnicity       byte    %8.0g                 
care_home_type  str2    %9s                   
hh_id           int     %8.0g                 
hh_size         byte    %8.0g                 
is_prison       byte    %8.0g                 
gp_consult_co~t byte    %8.0g                 
has_consultat~y byte    %8.0g                 
bmi             float   %9.0g                 
bp_sys          float   %9.0g                 
bp_dias         float   %9.0g                 
hba1c_mmol_pe~l float   %9.0g                 
hba1c_percen~ge float   %9.0g                 
creatinine      float   %9.0g                 
smoking_status  str1    %9s                   
asthma          byte    %8.0g                 
diabetes_type   str10   %10s                  
diabetes_exet~s str10   %10s                  
diabetes_exeter str7    %9s                   
ace_inhibitors  byte    %8.0g                 
alpha_blockers  byte    %8.0g                 
arbs            byte    %8.0g                 
betablockers    byte    %8.0g                 
calcium_chann~s byte    %8.0g                 
combination_b~s byte    %8.0g                 
spironolactone  byte    %8.0g                 
thiazide_diur~s byte    %8.0g                 
patient_id      long    %12.0g                
male            float   %9.0g      male       
imd             float   %16.0g     imd        
age1            float   %9.0g                 
age2            float   %9.0g                 
age3            float   %9.0g                 
index           str10   %10s                  
indexdate       float   %d                    
onscoviddeath~e str10   %10s                  
onsconfirmedd~e str10   %10s                  
onssuspectedd~e str10   %10s                  
ons_noncovidd~e str10   %10s                  
tested_date     float   %td                   
positivetest_~e float   %td                   
------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

   hes_date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2020-09-02 |        134        0.67        0.67
 2020-09-03 |        146        0.73        1.41
 2020-09-04 |        143        0.72        2.13
 2020-09-05 |        149        0.75        2.88
 2020-09-06 |        143        0.72        3.60
 2020-09-07 |        139        0.70        4.30
 2020-09-08 |        153        0.77        5.07
 2020-09-09 |        145        0.73        5.80
 2020-09-10 |        118        0.59        6.39
 2020-09-11 |        142        0.71        7.10
 2020-09-12 |        148        0.74        7.85
 2020-09-13 |        154        0.77        8.62
 2020-09-14 |        130        0.65        9.28
 2020-09-15 |        140        0.70        9.98
 2020-09-16 |        136        0.68       10.67
 2020-09-17 |        143        0.72       11.38
 2020-09-18 |        154        0.77       12.16
 2020-09-19 |        146        0.73       12.89
 2020-09-20 |        154        0.77       13.67
 2020-09-21 |        157        0.79       14.46
 2020-09-22 |        140        0.70       15.16
 2020-09-23 |        160        0.80       15.97
 2020-09-24 |        145        0.73       16.70
 2020-09-25 |        140        0.70       17.40
 2020-09-26 |        139        0.70       18.10
 2020-09-27 |        138        0.69       18.79
 2020-09-28 |        147        0.74       19.53
 2020-09-29 |        139        0.70       20.23
 2020-09-30 |        147        0.74       20.97
 2020-10-01 |        154        0.77       21.75
 2020-10-02 |        152        0.76       22.51
 2020-10-03 |        143        0.72       23.23
 2020-10-04 |        129        0.65       23.88
 2020-10-05 |        149        0.75       24.63
 2020-10-06 |        136        0.68       25.31
 2020-10-07 |        156        0.78       26.10
 2020-10-08 |        160        0.80       26.90
 2020-10-09 |        135        0.68       27.58
 2020-10-10 |        138        0.69       28.28
 2020-10-11 |        140        0.70       28.98
 2020-10-12 |        150        0.75       29.74
 2020-10-13 |        127        0.64       30.38
 2020-10-14 |        153        0.77       31.14
 2020-10-15 |        140        0.70       31.85
 2020-10-16 |        141        0.71       32.56
 2020-10-17 |        153        0.77       33.33
 2020-10-18 |        143        0.72       34.05
 2020-10-19 |        122        0.61       34.66
 2020-10-20 |        154        0.77       35.44
 2020-10-21 |        163        0.82       36.26
 2020-10-22 |        154        0.77       37.03
 2020-10-23 |        141        0.71       37.74
 2020-10-24 |        149        0.75       38.49
 2020-10-25 |        125        0.63       39.12
 2020-10-26 |        150        0.75       39.87
 2020-10-27 |        144        0.72       40.60
 2020-10-28 |        130        0.65       41.25
 2020-10-29 |        141        0.71       41.96
 2020-10-30 |        151        0.76       42.72
 2020-10-31 |        140        0.70       43.42
 2020-11-01 |        126        0.63       44.06
 2020-11-02 |        137        0.69       44.75
 2020-11-03 |        135        0.68       45.43
 2020-11-04 |        141        0.71       46.14
 2020-11-05 |        151        0.76       46.90
 2020-11-06 |        123        0.62       47.51
 2020-11-07 |        152        0.76       48.28
 2020-11-08 |        139        0.70       48.98
 2020-11-09 |        150        0.75       49.73
 2020-11-10 |        155        0.78       50.51
 2020-11-11 |        141        0.71       51.22
 2020-11-12 |        132        0.66       51.89
 2020-11-13 |        172        0.87       52.75
 2020-11-14 |        185        0.93       53.68
 2020-11-15 |        151        0.76       54.44
 2020-11-16 |        151        0.76       55.20
 2020-11-17 |        148        0.74       55.95
 2020-11-18 |        124        0.62       56.57
 2020-11-19 |        156        0.78       57.35
 2020-11-20 |        133        0.67       58.02
 2020-11-21 |        131        0.66       58.68
 2020-11-22 |        154        0.77       59.46
 2020-11-23 |        130        0.65       60.11
 2020-11-24 |        125        0.63       60.74
 2020-11-25 |        140        0.70       61.44
 2020-11-26 |        145        0.73       62.17
 2020-11-27 |        137        0.69       62.86
 2020-11-28 |        118        0.59       63.46
 2020-11-29 |        129        0.65       64.11
 2020-11-30 |        153        0.77       64.88
 2020-12-01 |        151        0.76       65.64
 2020-12-02 |        163        0.82       66.46
 2020-12-03 |        161        0.81       67.27
 2020-12-04 |        152        0.76       68.03
 2020-12-05 |        161        0.81       68.84
 2020-12-06 |        126        0.63       69.47
 2020-12-07 |        144        0.72       70.20
 2020-12-08 |        140        0.70       70.90
 2020-12-09 |        157        0.79       71.69
 2020-12-10 |        126        0.63       72.33
 2020-12-11 |        143        0.72       73.05
 2020-12-12 |        134        0.67       73.72
 2020-12-13 |        135        0.68       74.40
 2020-12-14 |        122        0.61       75.01
 2020-12-15 |        141        0.71       75.72
 2020-12-16 |        160        0.80       76.53
 2020-12-17 |        148        0.74       77.27
 2020-12-18 |        161        0.81       78.08
 2020-12-19 |        134        0.67       78.76
 2020-12-20 |        150        0.75       79.51
 2020-12-21 |        127        0.64       80.15
 2020-12-22 |        149        0.75       80.90
 2020-12-23 |        150        0.75       81.65
 2020-12-24 |        142        0.71       82.37
 2020-12-25 |        152        0.76       83.13
 2020-12-26 |        152        0.76       83.90
 2020-12-27 |        144        0.72       84.62
 2020-12-28 |        133        0.67       85.29
 2020-12-29 |        141        0.71       86.00
 2020-12-30 |        147        0.74       86.74
 2020-12-31 |        150        0.75       87.49
 2021-01-01 |        134        0.67       88.17
 2021-01-02 |        137        0.69       88.86
 2021-01-03 |        126        0.63       89.49
 2021-01-04 |        139        0.70       90.19
 2021-01-05 |        142        0.71       90.90
 2021-01-06 |        133        0.67       91.57
 2021-01-07 |        153        0.77       92.34
 2021-01-08 |        118        0.59       92.94
 2021-01-09 |        136        0.68       93.62
 2021-01-10 |        136        0.68       94.31
 2021-01-11 |        121        0.61       94.91
 2021-01-12 |        157        0.79       95.70
 2021-01-13 |        150        0.75       96.46
 2021-01-14 |        151        0.76       97.22
 2021-01-15 |        139        0.70       97.92
 2021-01-16 |        141        0.71       98.63
 2021-01-17 |        145        0.73       99.36
 2021-01-18 |        128        0.64      100.00
------------+-----------------------------------
      Total |     19,878      100.00
(59,182 missing values generated)

Contains data
  obs:        79,060                          
 vars:            90                          
------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
dereg_date      str7    %9s                   
confirmed_date  str10   %10s                  
primary_care~se str10   %10s                  
primary_care~re str10   %10s                  
suspected_date  str10   %10s                  
ae_date         str10   %10s                  
icu_date        str10   %10s                  
cpnsdeath_date  str10   %10s                  
onsdeath_date   str10   %10s                  
ethnicity_16_~e int     %8.0g                 
ethnicity_date  int     %8.0g                 
bmi_date_meas~d str7    %9s                   
bp_sys_date_m~d str7    %9s                   
bp_dias_date_~d str7    %9s                   
hba1c_mmol_pe~e str7    %9s                   
hba1c_percen~te str7    %9s                   
creatinine_date str7    %9s                   
smoking_statu~e str7    %9s                   
chronic_respi~e str7    %9s                   
chronic_cardi~e str7    %9s                   
type1_diabetes  str7    %9s                   
type2_diabetes  str7    %9s                   
unknown_diabe~s str7    %9s                   
cancer          str7    %9s                   
permanent_imm~y str7    %9s                   
temporary_imm~y str7    %9s                   
chronic_liver~e str7    %9s                   
other_neuro     str7    %9s                   
stroke          str7    %9s                   
dementia        str7    %9s                   
esrf            str7    %9s                   
hypertension    str7    %9s                   
ra_sle_psoria~s str7    %9s                   
insulin         str7    %9s                   
statin          str7    %9s                   
any_resp_supp~g byte    %8.0g                 
basic_resp_su~g byte    %8.0g                 
advanced_resp~g byte    %8.0g                 
covid_admissi~i str4    %9s                   covid_admission_primary_diagnosis
died_ons_covi~y byte    %8.0g                 
died_ons_conf~y byte    %8.0g                 
died_ons_susp~y byte    %8.0g                 
died_ons_covi~g byte    %8.0g                 
age             int     %8.0g                 
sex             str1    %9s                   
rural_urban     str5    %9s                   
stp             str5    %9s                   
region          str24   %24s                  
ethnicity_16    byte    %8.0g                 
ethnicity       byte    %8.0g                 
care_home_type  str2    %9s                   
hh_id           int     %8.0g                 
hh_size         byte    %8.0g                 
is_prison       byte    %8.0g                 
gp_consult_co~t byte    %8.0g                 
has_consultat~y byte    %8.0g                 
bmi             float   %9.0g                 
bp_sys          float   %9.0g                 
bp_dias         float   %9.0g                 
hba1c_mmol_pe~l float   %9.0g                 
hba1c_percen~ge float   %9.0g                 
creatinine      float   %9.0g                 
smoking_status  str1    %9s                   
asthma          byte    %8.0g                 
diabetes_type   str10   %10s                  
diabetes_exet~s str10   %10s                  
diabetes_exeter str7    %9s                   
ace_inhibitors  byte    %8.0g                 
alpha_blockers  byte    %8.0g                 
arbs            byte    %8.0g                 
betablockers    byte    %8.0g                 
calcium_chann~s byte    %8.0g                 
combination_b~s byte    %8.0g                 
spironolactone  byte    %8.0g                 
thiazide_diur~s byte    %8.0g                 
patient_id      long    %12.0g                
male            float   %9.0g      male       
imd             float   %16.0g     imd        
age1            float   %9.0g                 
age2            float   %9.0g                 
age3            float   %9.0g                 
index           str10   %10s                  
indexdate       float   %d                    
onscoviddeath~e str10   %10s                  
onsconfirmedd~e str10   %10s                  
onssuspectedd~e str10   %10s                  
ons_noncovidd~e str10   %10s                  
tested_date     float   %td                   
positivetest_~e float   %td                   
hes_date        float   %td                   
------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

**TABLE OF icu_date REDACTED DUE TO SMALL N**

(63,223 missing values generated)

Contains data
  obs:        79,060                          
 vars:            90                          
------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
dereg_date      str7    %9s                   
confirmed_date  str10   %10s                  
primary_care~se str10   %10s                  
primary_care~re str10   %10s                  
suspected_date  str10   %10s                  
ae_date         str10   %10s                  
cpnsdeath_date  str10   %10s                  
onsdeath_date   str10   %10s                  
ethnicity_16_~e int     %8.0g                 
ethnicity_date  int     %8.0g                 
bmi_date_meas~d str7    %9s                   
bp_sys_date_m~d str7    %9s                   
bp_dias_date_~d str7    %9s                   
hba1c_mmol_pe~e str7    %9s                   
hba1c_percen~te str7    %9s                   
creatinine_date str7    %9s                   
smoking_statu~e str7    %9s                   
chronic_respi~e str7    %9s                   
chronic_cardi~e str7    %9s                   
type1_diabetes  str7    %9s                   
type2_diabetes  str7    %9s                   
unknown_diabe~s str7    %9s                   
cancer          str7    %9s                   
permanent_imm~y str7    %9s                   
temporary_imm~y str7    %9s                   
chronic_liver~e str7    %9s                   
other_neuro     str7    %9s                   
stroke          str7    %9s                   
dementia        str7    %9s                   
esrf            str7    %9s                   
hypertension    str7    %9s                   
ra_sle_psoria~s str7    %9s                   
insulin         str7    %9s                   
statin          str7    %9s                   
any_resp_supp~g byte    %8.0g                 
basic_resp_su~g byte    %8.0g                 
advanced_resp~g byte    %8.0g                 
covid_admissi~i str4    %9s                   covid_admission_primary_diagnosis
died_ons_covi~y byte    %8.0g                 
died_ons_conf~y byte    %8.0g                 
died_ons_susp~y byte    %8.0g                 
died_ons_covi~g byte    %8.0g                 
age             int     %8.0g                 
sex             str1    %9s                   
rural_urban     str5    %9s                   
stp             str5    %9s                   
region          str24   %24s                  
ethnicity_16    byte    %8.0g                 
ethnicity       byte    %8.0g                 
care_home_type  str2    %9s                   
hh_id           int     %8.0g                 
hh_size         byte    %8.0g                 
is_prison       byte    %8.0g                 
gp_consult_co~t byte    %8.0g                 
has_consultat~y byte    %8.0g                 
bmi             float   %9.0g                 
bp_sys          float   %9.0g                 
bp_dias         float   %9.0g                 
hba1c_mmol_pe~l float   %9.0g                 
hba1c_percen~ge float   %9.0g                 
creatinine      float   %9.0g                 
smoking_status  str1    %9s                   
asthma          byte    %8.0g                 
diabetes_type   str10   %10s                  
diabetes_exet~s str10   %10s                  
diabetes_exeter str7    %9s                   
ace_inhibitors  byte    %8.0g                 
alpha_blockers  byte    %8.0g                 
arbs            byte    %8.0g                 
betablockers    byte    %8.0g                 
calcium_chann~s byte    %8.0g                 
combination_b~s byte    %8.0g                 
spironolactone  byte    %8.0g                 
thiazide_diur~s byte    %8.0g                 
patient_id      long    %12.0g                
male            float   %9.0g      male       
imd             float   %16.0g     imd        
age1            float   %9.0g                 
age2            float   %9.0g                 
age3            float   %9.0g                 
index           str10   %10s                  
indexdate       float   %d                    
onscoviddeath~e str10   %10s                  
onsconfirmedd~e str10   %10s                  
onssuspectedd~e str10   %10s                  
ons_noncovidd~e str10   %10s                  
tested_date     float   %td                   
positivetest_~e float   %td                   
hes_date        float   %td                   
icu_date        float   %td                   
------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

onscoviddea |
    th_date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2020-09-02 |         37        0.76        0.76
 2020-09-03 |         30        0.61        1.37
 2020-09-04 |         33        0.67        2.04
 2020-09-05 |         41        0.84        2.88
 2020-09-06 |         28        0.57        3.45
 2020-09-07 |         26        0.53        3.98
 2020-09-08 |         40        0.82        4.80
 2020-09-09 |         37        0.76        5.56
 2020-09-10 |         35        0.72        6.27
 2020-09-11 |         26        0.53        6.80
 2020-09-12 |         24        0.49        7.29
 2020-09-13 |         28        0.57        7.87
 2020-09-14 |         34        0.69        8.56
 2020-09-15 |         33        0.67        9.23
 2020-09-16 |         35        0.72        9.95
 2020-09-17 |         44        0.90       10.85
 2020-09-18 |         32        0.65       11.50
 2020-09-19 |         35        0.72       12.22
 2020-09-20 |         42        0.86       13.07
 2020-09-21 |         34        0.69       13.77
 2020-09-22 |         42        0.86       14.63
 2020-09-23 |         25        0.51       15.14
 2020-09-24 |         33        0.67       15.81
 2020-09-25 |         38        0.78       16.59
 2020-09-26 |         38        0.78       17.36
 2020-09-27 |         35        0.72       18.08
 2020-09-28 |         30        0.61       18.69
 2020-09-29 |         30        0.61       19.31
 2020-09-30 |         32        0.65       19.96
 2020-10-01 |         36        0.74       20.69
 2020-10-02 |         37        0.76       21.45
 2020-10-03 |         38        0.78       22.23
 2020-10-04 |         33        0.67       22.90
 2020-10-05 |         37        0.76       23.66
 2020-10-06 |         20        0.41       24.07
 2020-10-07 |         40        0.82       24.88
 2020-10-08 |         34        0.69       25.58
 2020-10-09 |         37        0.76       26.33
 2020-10-10 |         39        0.80       27.13
 2020-10-11 |         28        0.57       27.70
 2020-10-12 |         38        0.78       28.48
 2020-10-13 |         38        0.78       29.25
 2020-10-14 |         30        0.61       29.87
 2020-10-15 |         32        0.65       30.52
 2020-10-16 |         32        0.65       31.17
 2020-10-17 |         31        0.63       31.81
 2020-10-18 |         38        0.78       32.58
 2020-10-19 |         33        0.67       33.26
 2020-10-20 |         37        0.76       34.01
 2020-10-21 |         39        0.80       34.81
 2020-10-22 |         46        0.94       35.75
 2020-10-23 |         30        0.61       36.36
 2020-10-24 |         27        0.55       36.92
 2020-10-25 |         41        0.84       37.75
 2020-10-26 |         27        0.55       38.30
 2020-10-27 |         28        0.57       38.88
 2020-10-28 |         35        0.72       39.59
 2020-10-29 |         38        0.78       40.37
 2020-10-30 |         45        0.92       41.29
 2020-10-31 |         42        0.86       42.15
 2020-11-01 |         30        0.61       42.76
 2020-11-02 |         33        0.67       43.43
 2020-11-03 |         35        0.72       44.15
 2020-11-04 |         40        0.82       44.96
 2020-11-05 |         41        0.84       45.80
 2020-11-06 |         33        0.67       46.48
 2020-11-07 |         45        0.92       47.40
 2020-11-08 |         41        0.84       48.23
 2020-11-09 |         36        0.74       48.97
 2020-11-10 |         34        0.69       49.66
 2020-11-11 |         39        0.80       50.46
 2020-11-12 |         27        0.55       51.01
 2020-11-13 |         25        0.51       51.52
 2020-11-14 |         43        0.88       52.40
 2020-11-15 |         35        0.72       53.12
 2020-11-16 |         45        0.92       54.03
 2020-11-17 |         34        0.69       54.73
 2020-11-18 |         29        0.59       55.32
 2020-11-19 |         44        0.90       56.22
 2020-11-20 |         32        0.65       56.87
 2020-11-21 |         34        0.69       57.57
 2020-11-22 |         37        0.76       58.32
 2020-11-23 |         28        0.57       58.90
 2020-11-24 |         34        0.69       59.59
 2020-11-25 |         33        0.67       60.27
 2020-11-26 |         40        0.82       61.08
 2020-11-27 |         45        0.92       62.00
 2020-11-28 |         34        0.69       62.70
 2020-11-29 |         33        0.67       63.37
 2020-11-30 |         30        0.61       63.98
 2020-12-01 |         40        0.82       64.80
 2020-12-02 |         33        0.67       65.47
 2020-12-03 |         35        0.72       66.19
 2020-12-04 |         37        0.76       66.95
 2020-12-05 |         35        0.72       67.66
 2020-12-06 |         36        0.74       68.40
 2020-12-07 |         24        0.49       68.89
 2020-12-08 |         33        0.67       69.56
 2020-12-09 |         34        0.69       70.26
 2020-12-10 |         42        0.86       71.11
 2020-12-11 |         35        0.72       71.83
 2020-12-12 |         29        0.59       72.42
 2020-12-13 |         45        0.92       73.34
 2020-12-14 |         36        0.74       74.08
 2020-12-15 |         39        0.80       74.87
 2020-12-16 |         32        0.65       75.53
 2020-12-17 |         50        1.02       76.55
 2020-12-18 |         34        0.69       77.24
 2020-12-19 |         33        0.67       77.92
 2020-12-20 |         42        0.86       78.77
 2020-12-21 |         28        0.57       79.35
 2020-12-22 |         33        0.67       80.02
 2020-12-23 |         29        0.59       80.61
 2020-12-24 |         38        0.78       81.39
 2020-12-25 |         38        0.78       82.17
 2020-12-26 |         42        0.86       83.02
 2020-12-27 |         43        0.88       83.90
 2020-12-28 |         28        0.57       84.47
 2020-12-29 |         27        0.55       85.03
 2020-12-30 |         32        0.65       85.68
 2020-12-31 |         28        0.57       86.25
 2021-01-01 |         45        0.92       87.17
 2021-01-02 |         38        0.78       87.95
 2021-01-03 |         48        0.98       88.93
 2021-01-04 |         35        0.72       89.64
 2021-01-05 |         35        0.72       90.36
 2021-01-06 |         25        0.51       90.87
 2021-01-07 |         36        0.74       91.60
 2021-01-08 |         45        0.92       92.52
 2021-01-09 |         35        0.72       93.24
 2021-01-10 |         37        0.76       93.99
 2021-01-11 |         34        0.69       94.69
 2021-01-12 |         37        0.76       95.44
 2021-01-13 |         33        0.67       96.12
 2021-01-14 |         31        0.63       96.75
 2021-01-15 |         38        0.78       97.53
 2021-01-16 |         41        0.84       98.37
 2021-01-17 |         39        0.80       99.16
 2021-01-18 |         41        0.84      100.00
------------+-----------------------------------
      Total |      4,895      100.00
(74,165 missing values generated)

Contains data
  obs:        79,060                          
 vars:            90                          
------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
dereg_date      str7    %9s                   
confirmed_date  str10   %10s                  
primary_care~se str10   %10s                  
primary_care~re str10   %10s                  
suspected_date  str10   %10s                  
ae_date         str10   %10s                  
cpnsdeath_date  str10   %10s                  
onsdeath_date   str10   %10s                  
ethnicity_16_~e int     %8.0g                 
ethnicity_date  int     %8.0g                 
bmi_date_meas~d str7    %9s                   
bp_sys_date_m~d str7    %9s                   
bp_dias_date_~d str7    %9s                   
hba1c_mmol_pe~e str7    %9s                   
hba1c_percen~te str7    %9s                   
creatinine_date str7    %9s                   
smoking_statu~e str7    %9s                   
chronic_respi~e str7    %9s                   
chronic_cardi~e str7    %9s                   
type1_diabetes  str7    %9s                   
type2_diabetes  str7    %9s                   
unknown_diabe~s str7    %9s                   
cancer          str7    %9s                   
permanent_imm~y str7    %9s                   
temporary_imm~y str7    %9s                   
chronic_liver~e str7    %9s                   
other_neuro     str7    %9s                   
stroke          str7    %9s                   
dementia        str7    %9s                   
esrf            str7    %9s                   
hypertension    str7    %9s                   
ra_sle_psoria~s str7    %9s                   
insulin         str7    %9s                   
statin          str7    %9s                   
any_resp_supp~g byte    %8.0g                 
basic_resp_su~g byte    %8.0g                 
advanced_resp~g byte    %8.0g                 
covid_admissi~i str4    %9s                   covid_admission_primary_diagnosis
died_ons_covi~y byte    %8.0g                 
died_ons_conf~y byte    %8.0g                 
died_ons_susp~y byte    %8.0g                 
died_ons_covi~g byte    %8.0g                 
age             int     %8.0g                 
sex             str1    %9s                   
rural_urban     str5    %9s                   
stp             str5    %9s                   
region          str24   %24s                  
ethnicity_16    byte    %8.0g                 
ethnicity       byte    %8.0g                 
care_home_type  str2    %9s                   
hh_id           int     %8.0g                 
hh_size         byte    %8.0g                 
is_prison       byte    %8.0g                 
gp_consult_co~t byte    %8.0g                 
has_consultat~y byte    %8.0g                 
bmi             float   %9.0g                 
bp_sys          float   %9.0g                 
bp_dias         float   %9.0g                 
hba1c_mmol_pe~l float   %9.0g                 
hba1c_percen~ge float   %9.0g                 
creatinine      float   %9.0g                 
smoking_status  str1    %9s                   
asthma          byte    %8.0g                 
diabetes_type   str10   %10s                  
diabetes_exet~s str10   %10s                  
diabetes_exeter str7    %9s                   
ace_inhibitors  byte    %8.0g                 
alpha_blockers  byte    %8.0g                 
arbs            byte    %8.0g                 
betablockers    byte    %8.0g                 
calcium_chann~s byte    %8.0g                 
combination_b~s byte    %8.0g                 
spironolactone  byte    %8.0g                 
thiazide_diur~s byte    %8.0g                 
patient_id      long    %12.0g                
male            float   %9.0g      male       
imd             float   %16.0g     imd        
age1            float   %9.0g                 
age2            float   %9.0g                 
age3            float   %9.0g                 
index           str10   %10s                  
indexdate       float   %d                    
onsconfirmedd~e str10   %10s                  
onssuspectedd~e str10   %10s                  
ons_noncovidd~e str10   %10s                  
tested_date     float   %td                   
positivetest_~e float   %td                   
hes_date        float   %td                   
icu_date        float   %td                   
onscoviddeath~e float   %td                   
------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

ons_noncovi |
ddeath_date |      Freq.     Percent        Cum.
------------+-----------------------------------
 2020-09-02 |        109        0.74        0.74
 2020-09-03 |        109        0.74        1.47
 2020-09-04 |        112        0.76        2.23
 2020-09-05 |        119        0.80        3.03
 2020-09-06 |        129        0.87        3.90
 2020-09-07 |        117        0.79        4.69
 2020-09-08 |        106        0.72        5.41
 2020-09-09 |        100        0.68        6.08
 2020-09-10 |        114        0.77        6.85
 2020-09-11 |        105        0.71        7.56
 2020-09-12 |        113        0.76        8.32
 2020-09-13 |        102        0.69        9.01
 2020-09-14 |        116        0.78        9.80
 2020-09-15 |        103        0.70       10.49
 2020-09-16 |        100        0.68       11.17
 2020-09-17 |         88        0.59       11.76
 2020-09-18 |        104        0.70       12.46
 2020-09-19 |        106        0.72       13.18
 2020-09-20 |        113        0.76       13.94
 2020-09-21 |        116        0.78       14.73
 2020-09-22 |         98        0.66       15.39
 2020-09-23 |         99        0.67       16.06
 2020-09-24 |         99        0.67       16.72
 2020-09-25 |        103        0.70       17.42
 2020-09-26 |         88        0.59       18.01
 2020-09-27 |        101        0.68       18.70
 2020-09-28 |        103        0.70       19.39
 2020-09-29 |        110        0.74       20.13
 2020-09-30 |        117        0.79       20.92
 2020-10-01 |        114        0.77       21.69
 2020-10-02 |         97        0.65       22.35
 2020-10-03 |        101        0.68       23.03
 2020-10-04 |        101        0.68       23.71
 2020-10-05 |        109        0.74       24.45
 2020-10-06 |        104        0.70       25.15
 2020-10-07 |        117        0.79       25.94
 2020-10-08 |        103        0.70       26.64
 2020-10-09 |         99        0.67       27.30
 2020-10-10 |         94        0.63       27.94
 2020-10-11 |        115        0.78       28.72
 2020-10-12 |        101        0.68       29.40
 2020-10-13 |        128        0.86       30.26
 2020-10-14 |        101        0.68       30.94
 2020-10-15 |        105        0.71       31.65
 2020-10-16 |         99        0.67       32.32
 2020-10-17 |        110        0.74       33.06
 2020-10-18 |        108        0.73       33.79
 2020-10-19 |        114        0.77       34.56
 2020-10-20 |         90        0.61       35.17
 2020-10-21 |        118        0.80       35.97
 2020-10-22 |        122        0.82       36.79
 2020-10-23 |         85        0.57       37.36
 2020-10-24 |         96        0.65       38.01
 2020-10-25 |        106        0.72       38.73
 2020-10-26 |        104        0.70       39.43
 2020-10-27 |        100        0.68       40.11
 2020-10-28 |        108        0.73       40.83
 2020-10-29 |         96        0.65       41.48
 2020-10-30 |        102        0.69       42.17
 2020-10-31 |        110        0.74       42.91
 2020-11-01 |        111        0.75       43.66
 2020-11-02 |        100        0.68       44.34
 2020-11-03 |        101        0.68       45.02
 2020-11-04 |        106        0.72       45.74
 2020-11-05 |        105        0.71       46.45
 2020-11-06 |        103        0.70       47.14
 2020-11-07 |        122        0.82       47.96
 2020-11-08 |         99        0.67       48.63
 2020-11-09 |        113        0.76       49.40
 2020-11-10 |        110        0.74       50.14
 2020-11-11 |        117        0.79       50.93
 2020-11-12 |        108        0.73       51.66
 2020-11-13 |        111        0.75       52.41
 2020-11-14 |        102        0.69       53.10
 2020-11-15 |        101        0.68       53.78
 2020-11-16 |        122        0.82       54.60
 2020-11-17 |         97        0.65       55.26
 2020-11-18 |        110        0.74       56.00
 2020-11-19 |        124        0.84       56.84
 2020-11-20 |         99        0.67       57.50
 2020-11-21 |        111        0.75       58.25
 2020-11-22 |        128        0.86       59.12
 2020-11-23 |        130        0.88       60.00
 2020-11-24 |        106        0.72       60.71
 2020-11-25 |        114        0.77       61.48
 2020-11-26 |        101        0.68       62.16
 2020-11-27 |         70        0.47       62.64
 2020-11-28 |         88        0.59       63.23
 2020-11-29 |        106        0.72       63.95
 2020-11-30 |        116        0.78       64.73
 2020-12-01 |        115        0.78       65.51
 2020-12-02 |        115        0.78       66.28
 2020-12-03 |        110        0.74       67.02
 2020-12-04 |        116        0.78       67.81
 2020-12-05 |         93        0.63       68.44
 2020-12-06 |        115        0.78       69.21
 2020-12-07 |        110        0.74       69.95
 2020-12-08 |        101        0.68       70.64
 2020-12-09 |        112        0.76       71.39
 2020-12-10 |         99        0.67       72.06
 2020-12-11 |        111        0.75       72.81
 2020-12-12 |        105        0.71       73.52
 2020-12-13 |         89        0.60       74.12
 2020-12-14 |         92        0.62       74.74
 2020-12-15 |        105        0.71       75.45
 2020-12-16 |        112        0.76       76.21
 2020-12-17 |        112        0.76       76.96
 2020-12-18 |         98        0.66       77.62
 2020-12-19 |        100        0.68       78.30
 2020-12-20 |        117        0.79       79.09
 2020-12-21 |        102        0.69       79.78
 2020-12-22 |        130        0.88       80.66
 2020-12-23 |        118        0.80       81.45
 2020-12-24 |        119        0.80       82.26
 2020-12-25 |         91        0.61       82.87
 2020-12-26 |        103        0.70       83.57
 2020-12-27 |         80        0.54       84.11
 2020-12-28 |        118        0.80       84.90
 2020-12-29 |         96        0.65       85.55
 2020-12-30 |        102        0.69       86.24
 2020-12-31 |         92        0.62       86.86
 2021-01-01 |        123        0.83       87.69
 2021-01-02 |         97        0.65       88.35
 2021-01-03 |        111        0.75       89.10
 2021-01-04 |        109        0.74       89.83
 2021-01-05 |        108        0.73       90.56
 2021-01-06 |         93        0.63       91.19
 2021-01-07 |         95        0.64       91.83
 2021-01-08 |        113        0.76       92.59
 2021-01-09 |        102        0.69       93.28
 2021-01-10 |        103        0.70       93.98
 2021-01-11 |        109        0.74       94.71
 2021-01-12 |        104        0.70       95.42
 2021-01-13 |        119        0.80       96.22
 2021-01-14 |        103        0.70       96.91
 2021-01-15 |        104        0.70       97.62
 2021-01-16 |        121        0.82       98.43
 2021-01-17 |        120        0.81       99.24
 2021-01-18 |        112        0.76      100.00
------------+-----------------------------------
      Total |     14,811      100.00
(64,249 missing values generated)

Contains data
  obs:        79,060                          
 vars:            90                          
------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
dereg_date      str7    %9s                   
confirmed_date  str10   %10s                  
primary_care~se str10   %10s                  
primary_care~re str10   %10s                  
suspected_date  str10   %10s                  
ae_date         str10   %10s                  
cpnsdeath_date  str10   %10s                  
onsdeath_date   str10   %10s                  
ethnicity_16_~e int     %8.0g                 
ethnicity_date  int     %8.0g                 
bmi_date_meas~d str7    %9s                   
bp_sys_date_m~d str7    %9s                   
bp_dias_date_~d str7    %9s                   
hba1c_mmol_pe~e str7    %9s                   
hba1c_percen~te str7    %9s                   
creatinine_date str7    %9s                   
smoking_statu~e str7    %9s                   
chronic_respi~e str7    %9s                   
chronic_cardi~e str7    %9s                   
type1_diabetes  str7    %9s                   
type2_diabetes  str7    %9s                   
unknown_diabe~s str7    %9s                   
cancer          str7    %9s                   
permanent_imm~y str7    %9s                   
temporary_imm~y str7    %9s                   
chronic_liver~e str7    %9s                   
other_neuro     str7    %9s                   
stroke          str7    %9s                   
dementia        str7    %9s                   
esrf            str7    %9s                   
hypertension    str7    %9s                   
ra_sle_psoria~s str7    %9s                   
insulin         str7    %9s                   
statin          str7    %9s                   
any_resp_supp~g byte    %8.0g                 
basic_resp_su~g byte    %8.0g                 
advanced_resp~g byte    %8.0g                 
covid_admissi~i str4    %9s                   covid_admission_primary_diagnosis
died_ons_covi~y byte    %8.0g                 
died_ons_conf~y byte    %8.0g                 
died_ons_susp~y byte    %8.0g                 
died_ons_covi~g byte    %8.0g                 
age             int     %8.0g                 
sex             str1    %9s                   
rural_urban     str5    %9s                   
stp             str5    %9s                   
region          str24   %24s                  
ethnicity_16    byte    %8.0g                 
ethnicity       byte    %8.0g                 
care_home_type  str2    %9s                   
hh_id           int     %8.0g                 
hh_size         byte    %8.0g                 
is_prison       byte    %8.0g                 
gp_consult_co~t byte    %8.0g                 
has_consultat~y byte    %8.0g                 
bmi             float   %9.0g                 
bp_sys          float   %9.0g                 
bp_dias         float   %9.0g                 
hba1c_mmol_pe~l float   %9.0g                 
hba1c_percen~ge float   %9.0g                 
creatinine      float   %9.0g                 
smoking_status  str1    %9s                   
asthma          byte    %8.0g                 
diabetes_type   str10   %10s                  
diabetes_exet~s str10   %10s                  
diabetes_exeter str7    %9s                   
ace_inhibitors  byte    %8.0g                 
alpha_blockers  byte    %8.0g                 
arbs            byte    %8.0g                 
betablockers    byte    %8.0g                 
calcium_chann~s byte    %8.0g                 
combination_b~s byte    %8.0g                 
spironolactone  byte    %8.0g                 
thiazide_diur~s byte    %8.0g                 
patient_id      long    %12.0g                
male            float   %9.0g      male       
imd             float   %16.0g     imd        
age1            float   %9.0g                 
age2            float   %9.0g                 
age3            float   %9.0g                 
index           str10   %10s                  
indexdate       float   %d                    
onsconfirmedd~e str10   %10s                  
onssuspectedd~e str10   %10s                  
tested_date     float   %td                   
positivetest_~e float   %td                   
hes_date        float   %td                   
icu_date        float   %td                   
onscoviddeath~e float   %td                   
ons_noncovidd~e float   %td                   
------------------------------------------------------------------------------------
Sorted by: 
     Note: Dataset has changed since last saved.

onsdeath_da |
         te |      Freq.     Percent        Cum.
------------+-----------------------------------
 2020-09-02 |        146        0.74        0.74
 2020-09-03 |        139        0.71        1.45
 2020-09-04 |        145        0.74        2.18
 2020-09-05 |        160        0.81        2.99
 2020-09-06 |        157        0.80        3.79
 2020-09-07 |        143        0.73        4.52
 2020-09-08 |        146        0.74        5.26
 2020-09-09 |        137        0.70        5.95
 2020-09-10 |        149        0.76        6.71
 2020-09-11 |        131        0.66        7.37
 2020-09-12 |        137        0.70        8.07
 2020-09-13 |        130        0.66        8.73
 2020-09-14 |        150        0.76        9.49
 2020-09-15 |        136        0.69       10.18
 2020-09-16 |        135        0.69       10.86
 2020-09-17 |        132        0.67       11.53
 2020-09-18 |        136        0.69       12.22
 2020-09-19 |        141        0.72       12.94
 2020-09-20 |        155        0.79       13.73
 2020-09-21 |        150        0.76       14.49
 2020-09-22 |        140        0.71       15.20
 2020-09-23 |        124        0.63       15.83
 2020-09-24 |        132        0.67       16.50
 2020-09-25 |        141        0.72       17.21
 2020-09-26 |        126        0.64       17.85
 2020-09-27 |        136        0.69       18.54
 2020-09-28 |        133        0.67       19.22
 2020-09-29 |        140        0.71       19.93
 2020-09-30 |        149        0.76       20.68
 2020-10-01 |        150        0.76       21.45
 2020-10-02 |        134        0.68       22.13
 2020-10-03 |        139        0.71       22.83
 2020-10-04 |        134        0.68       23.51
 2020-10-05 |        146        0.74       24.25
 2020-10-06 |        124        0.63       24.88
 2020-10-07 |        157        0.80       25.68
 2020-10-08 |        137        0.70       26.37
 2020-10-09 |        136        0.69       27.06
 2020-10-10 |        133        0.67       27.74
 2020-10-11 |        143        0.73       28.46
 2020-10-12 |        139        0.71       29.17
 2020-10-13 |        166        0.84       30.01
 2020-10-14 |        131        0.66       30.68
 2020-10-15 |        137        0.70       31.37
 2020-10-16 |        131        0.66       32.04
 2020-10-17 |        141        0.72       32.75
 2020-10-18 |        146        0.74       33.49
 2020-10-19 |        147        0.75       34.24
 2020-10-20 |        127        0.64       34.88
 2020-10-21 |        157        0.80       35.68
 2020-10-22 |        168        0.85       36.53
 2020-10-23 |        115        0.58       37.12
 2020-10-24 |        123        0.62       37.74
 2020-10-25 |        147        0.75       38.49
 2020-10-26 |        131        0.66       39.15
 2020-10-27 |        128        0.65       39.80
 2020-10-28 |        143        0.73       40.53
 2020-10-29 |        134        0.68       41.21
 2020-10-30 |        147        0.75       41.95
 2020-10-31 |        152        0.77       42.72
 2020-11-01 |        141        0.72       43.44
 2020-11-02 |        133        0.67       44.11
 2020-11-03 |        136        0.69       44.80
 2020-11-04 |        146        0.74       45.54
 2020-11-05 |        146        0.74       46.29
 2020-11-06 |        136        0.69       46.98
 2020-11-07 |        167        0.85       47.82
 2020-11-08 |        140        0.71       48.53
 2020-11-09 |        149        0.76       49.29
 2020-11-10 |        144        0.73       50.02
 2020-11-11 |        156        0.79       50.81
 2020-11-12 |        135        0.69       51.50
 2020-11-13 |        136        0.69       52.19
 2020-11-14 |        145        0.74       52.92
 2020-11-15 |        136        0.69       53.61
 2020-11-16 |        167        0.85       54.46
 2020-11-17 |        131        0.66       55.13
 2020-11-18 |        139        0.71       55.83
 2020-11-19 |        168        0.85       56.68
 2020-11-20 |        131        0.66       57.35
 2020-11-21 |        145        0.74       58.08
 2020-11-22 |        165        0.84       58.92
 2020-11-23 |        158        0.80       59.72
 2020-11-24 |        140        0.71       60.43
 2020-11-25 |        147        0.75       61.18
 2020-11-26 |        141        0.72       61.89
 2020-11-27 |        115        0.58       62.48
 2020-11-28 |        122        0.62       63.10
 2020-11-29 |        139        0.71       63.80
 2020-11-30 |        146        0.74       64.54
 2020-12-01 |        155        0.79       65.33
 2020-12-02 |        148        0.75       66.08
 2020-12-03 |        145        0.74       66.82
 2020-12-04 |        153        0.78       67.59
 2020-12-05 |        128        0.65       68.24
 2020-12-06 |        151        0.77       69.01
 2020-12-07 |        134        0.68       69.69
 2020-12-08 |        134        0.68       70.37
 2020-12-09 |        146        0.74       71.11
 2020-12-10 |        141        0.72       71.83
 2020-12-11 |        146        0.74       72.57
 2020-12-12 |        134        0.68       73.25
 2020-12-13 |        134        0.68       73.93
 2020-12-14 |        128        0.65       74.58
 2020-12-15 |        144        0.73       75.31
 2020-12-16 |        144        0.73       76.04
 2020-12-17 |        162        0.82       76.86
 2020-12-18 |        132        0.67       77.53
 2020-12-19 |        133        0.67       78.20
 2020-12-20 |        159        0.81       79.01
 2020-12-21 |        130        0.66       79.67
 2020-12-22 |        163        0.83       80.50
 2020-12-23 |        147        0.75       81.24
 2020-12-24 |        157        0.80       82.04
 2020-12-25 |        129        0.65       82.70
 2020-12-26 |        145        0.74       83.43
 2020-12-27 |        123        0.62       84.06
 2020-12-28 |        146        0.74       84.80
 2020-12-29 |        123        0.62       85.42
 2020-12-30 |        134        0.68       86.10
 2020-12-31 |        120        0.61       86.71
 2021-01-01 |        168        0.85       87.56
 2021-01-02 |        135        0.69       88.25
 2021-01-03 |        159        0.81       89.05
 2021-01-04 |        144        0.73       89.78
 2021-01-05 |        143        0.73       90.51
 2021-01-06 |        118        0.60       91.11
 2021-01-07 |        131        0.66       91.77
 2021-01-08 |        158        0.80       92.58
 2021-01-09 |        137        0.70       93.27
 2021-01-10 |        140        0.71       93.98
 2021-01-11 |        143        0.73       94.71
 2021-01-12 |        141        0.72       95.42
 2021-01-13 |        152        0.77       96.19
 2021-01-14 |        134        0.68       96.87
 2021-01-15 |        142        0.72       97.59
 2021-01-16 |        162        0.82       98.42
 2021-01-17 |        159        0.81       99.22
 2021-01-18 |        153        0.78      100.00
------------+-----------------------------------
      Total |     19,706      100.00
(59,354 missing values generated)

. 
. *If outcome occurs on the first day of follow-up add one day
. foreach i of global outcomes {
  2.         di "`i'"
  3.         count if `i'_date==indexdate
  4.         replace `i'_date=`i'_date+1 if `i'_date==indexdate
  5. }
tested
  0
(0 real changes made)
positivetest
  0
(0 real changes made)
hes
  0
(0 real changes made)
icu
  0
(0 real changes made)
onscoviddeath
  0
(0 real changes made)
ons_noncoviddeath
  0
(0 real changes made)
onsdeath
  0
(0 real changes made)

. *date of deregistration
. rename dereg_date dereg_dstr

.         gen dereg_date = date(dereg_dstr, "YMD")
(79,060 missing values generated)

.         drop dereg_dstr

.         format dereg_date %td 

. 
. * Binary indicators for outcomes
. foreach i of global outcomes {
  2.                 gen `i'=0
  3.                 replace  `i'=1 if `i'_date < .
  4.                 safetab `i'
  5. }
(63,285 real changes made)

     tested |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     15,775       19.95       19.95
          1 |     63,285       80.05      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(63,215 real changes made)

positivetes |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     15,845       20.04       20.04
          1 |     63,215       79.96      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(19,878 real changes made)

        hes |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     59,182       74.86       74.86
          1 |     19,878       25.14      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(15,837 real changes made)

        icu |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,223       79.97       79.97
          1 |     15,837       20.03      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(4,895 real changes made)

onscoviddea |
         th |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     74,165       93.81       93.81
          1 |      4,895        6.19      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(14,811 real changes made)

ons_noncovi |
     ddeath |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     64,249       81.27       81.27
          1 |     14,811       18.73      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(19,706 real changes made)

   onsdeath |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     59,354       75.07       75.07
          1 |     19,706       24.93      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. /* CENSORING */
. /* SET FU DATES===============================================================*/ 
. 
. * Censoring dates for each outcome (last date outcome data available)
. *https://github.com/opensafely/rapid-reports/blob/master/notebooks/latest-dates.ip
> ynb
. gen tested_censor_date = d("31/12/2020")

. gen positivetest_censor_date = d("31/12/2020")

. gen ae_censor_date = d("31/12/2020")

. gen hes_censor_date = d("31/12/2020")

. gen icu_censor_date = d("31/12/2020")

. gen cpnsdeath_censor_date  = d("31/12/2020")

. gen onsdeath_censor_date = d("31/12/2020")

. gen onscoviddeath_censor_date = d("31/12/2020")

. gen ons_noncoviddeath_censor_date = d("31/12/2020")

. gen onsconfirmeddeath_censor_date=d("31/12/2020")

. 
. *******************************************************************************
. format *censor_date %d

. sum *censor_date, format

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
tested_cen~e |     79,060   31dec2020           0  31dec2020  31dec2020
posit~r_date |     79,060   31dec2020           0  31dec2020  31dec2020
ae_censor_~e |     79,060   31dec2020           0  31dec2020  31dec2020
hes_censor~e |     79,060   31dec2020           0  31dec2020  31dec2020
icu_censor~e |     79,060   31dec2020           0  31dec2020  31dec2020
-------------+---------------------------------------------------------
cpnsd~r_date |     79,060   31dec2020           0  31dec2020  31dec2020
onsdeath_c~e |     79,060   31dec2020           0  31dec2020  31dec2020
onscovidde.. |     79,060   31dec2020           0  31dec2020  31dec2020
ons_n~r_date |     79,060   31dec2020           0  31dec2020  31dec2020
onsconfirm.. |     79,060   31dec2020           0  31dec2020  31dec2020

. 
. 
. /* DEMOGRAPHICS */ 
. 
. * Ethnicity (5 category)
. label define ethnicity  1 "White"                                       ///
>                                                 2 "Mixed"                         
>               ///
>                                                 3 "Asian or Asian British"      //
> /
>                                                 4 "Black"                         
>               ///
>                                                 5 "Other"                         
>               

.                                                 
. label values ethnicity ethnicity

. safetab ethnicity, m

             ethnicity |      Freq.     Percent        Cum.
-----------------------+-----------------------------------
                 White |     11,846       14.98       14.98
                 Mixed |     11,810       14.94       29.92
Asian or Asian British |     11,958       15.13       45.05
                 Black |     11,915       15.07       60.12
                 Other |     11,825       14.96       75.07
                     . |     19,706       24.93      100.00
-----------------------+-----------------------------------
                 Total |     79,060      100.00

. 
.  *re-order ethnicity
.  gen eth5=1 if ethnicity==1
(67,214 missing values generated)

.  replace eth5=2 if ethnicity==3
(11,958 real changes made)

.  replace eth5=3 if ethnicity==4
(11,915 real changes made)

.  replace eth5=4 if ethnicity==2
(11,810 real changes made)

.  replace eth5=5 if ethnicity==5
(11,825 real changes made)

.  replace eth5=6 if ethnicity==.
(19,706 real changes made)

. 
.  label define eth5              1 "White"                                       //
> /
>                                                 2 "South Asian"           ///     
>                                       
>                                                 3 "Black"                         
>               ///
>                                                 4 "Mixed"                         
>               ///
>                                                 5 "Other"                         
>               ///
>                                                 6 "Unknown"

.                                         
. 
. label values eth5 eth5

. safetab eth5, m

       eth5 |      Freq.     Percent        Cum.
------------+-----------------------------------
      White |     11,846       14.98       14.98
South Asian |     11,958       15.13       30.11
      Black |     11,915       15.07       45.18
      Mixed |     11,810       14.94       60.12
      Other |     11,825       14.96       75.07
    Unknown |     19,706       24.93      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. * Ethnicity (16 category)
. replace ethnicity_16 = 17 if ethnicity_16==.
(19,820 real changes made)

. label define ethnicity_16                                                         
>               ///
>                                                 1 "British"             ///
>                                                 2 "Irish"                         
>                               ///
>                                                 3 "Other White"                   
>                       ///
>                                                 4 "White + Caribbean"           //
> /
>                                                 5 "White + African"               
>       ///
>                                                 6 "White + Asian"                 
>                       ///
>                                                 7 "Other mixed"                   
>                       ///
>                                                 8 "Indian"              ///
>                                                 9 "Pakistani"   ///
>                                                 10 "Bangladeshi" ///
>                                                 11 "Other Asian"                  
>                       ///
>                                                 12 "Caribbean"                    
>                       ///
>                                                 13 "African"                      
>                       ///
>                                                 14 "Other Black"                  
>                       ///
>                                                 15 "Chinese"                      
>                       ///
>                                                 16 "Other"                        
>                               ///
>                                                 17 "Unknown"

.                                                 
. label values ethnicity_16 ethnicity_16

. safetab ethnicity_16,m

     ethnicity_16 |      Freq.     Percent        Cum.
------------------+-----------------------------------
          British |      3,742        4.73        4.73
            Irish |      3,723        4.71        9.44
      Other White |      3,753        4.75       14.19
White + Caribbean |      3,679        4.65       18.84
  White + African |      3,633        4.60       23.44
    White + Asian |      3,768        4.77       28.20
      Other mixed |      3,692        4.67       32.87
           Indian |      3,622        4.58       37.46
        Pakistani |      3,687        4.66       42.12
      Bangladeshi |      3,714        4.70       46.82
      Other Asian |      3,701        4.68       51.50
        Caribbean |      3,717        4.70       56.20
          African |      3,803        4.81       61.01
      Other Black |      3,618        4.58       65.59
          Chinese |      3,678        4.65       70.24
            Other |      3,710        4.69       74.93
          Unknown |     19,820       25.07      100.00
------------------+-----------------------------------
            Total |     79,060      100.00

. 
. 
. * Ethnicity (16 category grouped further)
. * Generate a version of the full breakdown with mixed in one group
. gen eth16 = ethnicity_16

. recode eth16 4/7 = 99 //mixed
(eth16: 14772 changes made)

. recode eth16 8 = 4
(eth16: 3622 changes made)

. recode eth16 9 = 5
(eth16: 3687 changes made)

. recode eth16 10 = 6
(eth16: 3714 changes made)

. recode eth16 11= 7
(eth16: 3701 changes made)

. recode eth16 12 = 8
(eth16: 3717 changes made)

. recode eth16 13 = 9
(eth16: 3803 changes made)

. recode eth16 14 = 10
(eth16: 3618 changes made)

. recode eth16 15 = 11
(eth16: 3678 changes made)

. recode eth16 99 = 12
(eth16: 14772 changes made)

. recode eth16 16 = 13
(eth16: 3710 changes made)

. recode eth16 17 = 14
(eth16: 19820 changes made)

. 
. label define eth16      ///
>                                                 1 "British" ///
>                                                 2 "Irish" ///
>                                                 3 "Other White" ///
>                                                 4 "Indian" ///
>                                                 5 "Pakistani" ///
>                                                 6 "Bangladeshi" ///     
>                                                 7 "Other Asian" ///
>                                                 8 "Caribbean" ///
>                                                 9 "African" ///
>                                                 10 "Other Black" ///
>                                                 11 "Chinese" ///
>                                                 12 "All mixed" ///
>                                                 13  "Other" ///
>                                                 14 "Unknown"

. label values eth16 eth16

. safetab eth16,m

      eth16 |      Freq.     Percent        Cum.
------------+-----------------------------------
    British |      3,742        4.73        4.73
      Irish |      3,723        4.71        9.44
Other White |      3,753        4.75       14.19
     Indian |      3,622        4.58       18.77
  Pakistani |      3,687        4.66       23.43
Bangladeshi |      3,714        4.70       28.13
Other Asian |      3,701        4.68       32.81
  Caribbean |      3,717        4.70       37.51
    African |      3,803        4.81       42.32
Other Black |      3,618        4.58       46.90
    Chinese |      3,678        4.65       51.55
  All mixed |     14,772       18.68       70.24
      Other |      3,710        4.69       74.93
    Unknown |     19,820       25.07      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. safetab eth16 eth5, m

            |                          eth5
      eth16 |     White  South Asi      Black      Mixed      Other |     Total
------------+-------------------------------------------------------+----------
    British |       518        560        555        568        560 |     3,742 
      Irish |       566        581        556        554        571 |     3,723 
Other White |       549        547        569        609        536 |     3,753 
     Indian |       550        527        556        572        530 |     3,622 
  Pakistani |       554        582        557        544        553 |     3,687 
Bangladeshi |       538        582        602        536        540 |     3,714 
Other Asian |       572        540        573        557        536 |     3,701 
  Caribbean |       532        584        555        533        565 |     3,717 
    African |       586        608        546        559        544 |     3,803 
Other Black |       550        520        586        523        529 |     3,618 
    Chinese |       552        563        546        515        556 |     3,678 
  All mixed |     2,266      2,243      2,229      2,167      2,220 |    14,772 
      Other |       561        540        527        572        577 |     3,710 
    Unknown |     2,952      2,981      2,958      3,001      3,008 |    19,820 
------------+-------------------------------------------------------+----------
      Total |    11,846     11,958     11,915     11,810     11,825 |    79,060 


            |    eth5
      eth16 |   Unknown |     Total
------------+-----------+----------
    British |       981 |     3,742 
      Irish |       895 |     3,723 
Other White |       943 |     3,753 
     Indian |       887 |     3,622 
  Pakistani |       897 |     3,687 
Bangladeshi |       916 |     3,714 
Other Asian |       923 |     3,701 
  Caribbean |       948 |     3,717 
    African |       960 |     3,803 
Other Black |       910 |     3,618 
    Chinese |       946 |     3,678 
  All mixed |     3,647 |    14,772 
      Other |       933 |     3,710 
    Unknown |     4,920 |    19,820 
------------+-----------+----------
      Total |    19,706 |    79,060 

. bysort eth5: safetab eth16, m

------------------------------------------------------------------------------------
-> eth5 = White

      eth16 |      Freq.     Percent        Cum.
------------+-----------------------------------
    British |        518        4.37        4.37
      Irish |        566        4.78        9.15
Other White |        549        4.63       13.79
     Indian |        550        4.64       18.43
  Pakistani |        554        4.68       23.10
Bangladeshi |        538        4.54       27.65
Other Asian |        572        4.83       32.48
  Caribbean |        532        4.49       36.97
    African |        586        4.95       41.91
Other Black |        550        4.64       46.56
    Chinese |        552        4.66       51.22
  All mixed |      2,266       19.13       70.34
      Other |        561        4.74       75.08
    Unknown |      2,952       24.92      100.00
------------+-----------------------------------
      Total |     11,846      100.00

------------------------------------------------------------------------------------
-> eth5 = South Asian

      eth16 |      Freq.     Percent        Cum.
------------+-----------------------------------
    British |        560        4.68        4.68
      Irish |        581        4.86        9.54
Other White |        547        4.57       14.12
     Indian |        527        4.41       18.52
  Pakistani |        582        4.87       23.39
Bangladeshi |        582        4.87       28.26
Other Asian |        540        4.52       32.77
  Caribbean |        584        4.88       37.66
    African |        608        5.08       42.74
Other Black |        520        4.35       47.09
    Chinese |        563        4.71       51.80
  All mixed |      2,243       18.76       70.56
      Other |        540        4.52       75.07
    Unknown |      2,981       24.93      100.00
------------+-----------------------------------
      Total |     11,958      100.00

------------------------------------------------------------------------------------
-> eth5 = Black

      eth16 |      Freq.     Percent        Cum.
------------+-----------------------------------
    British |        555        4.66        4.66
      Irish |        556        4.67        9.32
Other White |        569        4.78       14.10
     Indian |        556        4.67       18.77
  Pakistani |        557        4.67       23.44
Bangladeshi |        602        5.05       28.49
Other Asian |        573        4.81       33.30
  Caribbean |        555        4.66       37.96
    African |        546        4.58       42.54
Other Black |        586        4.92       47.46
    Chinese |        546        4.58       52.04
  All mixed |      2,229       18.71       70.75
      Other |        527        4.42       75.17
    Unknown |      2,958       24.83      100.00
------------+-----------------------------------
      Total |     11,915      100.00

------------------------------------------------------------------------------------
-> eth5 = Mixed

      eth16 |      Freq.     Percent        Cum.
------------+-----------------------------------
    British |        568        4.81        4.81
      Irish |        554        4.69        9.50
Other White |        609        5.16       14.66
     Indian |        572        4.84       19.50
  Pakistani |        544        4.61       24.11
Bangladeshi |        536        4.54       28.65
Other Asian |        557        4.72       33.36
  Caribbean |        533        4.51       37.87
    African |        559        4.73       42.61
Other Black |        523        4.43       47.04
    Chinese |        515        4.36       51.40
  All mixed |      2,167       18.35       69.75
      Other |        572        4.84       74.59
    Unknown |      3,001       25.41      100.00
------------+-----------------------------------
      Total |     11,810      100.00

------------------------------------------------------------------------------------
-> eth5 = Other

      eth16 |      Freq.     Percent        Cum.
------------+-----------------------------------
    British |        560        4.74        4.74
      Irish |        571        4.83        9.56
Other White |        536        4.53       14.10
     Indian |        530        4.48       18.58
  Pakistani |        553        4.68       23.26
Bangladeshi |        540        4.57       27.82
Other Asian |        536        4.53       32.36
  Caribbean |        565        4.78       37.13
    African |        544        4.60       41.73
Other Black |        529        4.47       46.21
    Chinese |        556        4.70       50.91
  All mixed |      2,220       18.77       69.68
      Other |        577        4.88       74.56
    Unknown |      3,008       25.44      100.00
------------+-----------------------------------
      Total |     11,825      100.00

------------------------------------------------------------------------------------
-> eth5 = Unknown

      eth16 |      Freq.     Percent        Cum.
------------+-----------------------------------
    British |        981        4.98        4.98
      Irish |        895        4.54        9.52
Other White |        943        4.79       14.31
     Indian |        887        4.50       18.81
  Pakistani |        897        4.55       23.36
Bangladeshi |        916        4.65       28.01
Other Asian |        923        4.68       32.69
  Caribbean |        948        4.81       37.50
    African |        960        4.87       42.37
Other Black |        910        4.62       46.99
    Chinese |        946        4.80       51.79
  All mixed |      3,647       18.51       70.30
      Other |        933        4.73       75.03
    Unknown |      4,920       24.97      100.00
------------+-----------------------------------
      Total |     19,706      100.00

. 
. * STP 
. rename stp stp_old

. bysort stp_old: gen stp = 1 if _n==1
(79,050 missing values generated)

. replace stp = sum(stp)
(79,059 real changes made)

. drop stp_old

. 
. 
. 
. 
. /*  Age variables  */ 
. 
. * Create categorised age 
. recode age      0/17.9999=0 ///
>                         18/29.9999 = 1 /// 
>                     30/39.9999 = 2 /// 
>                         40/49.9999 = 3 ///
>                         50/59.9999 = 4 ///
>                         60/69.9999 = 5 ///
>                         70/79.9999 = 6 ///
>                         80/max = 7, gen(agegroup) 
(79060 differences between age and agegroup)

. 
. label define agegroup   0 "0-<18" ///
>                                                 1 "18-<30" ///
>                                                 2 "30-<40" ///
>                                                 3 "40-<50" ///
>                                                 4 "50-<60" ///
>                                                 5 "60-<70" ///
>                                                 6 "70-<80" ///
>                                                 7 "80+"

.                                                 
. label values agegroup agegroup

. 
. 
. 
. 
. 
. 
. **************************** HOUSEHOLD VARS***************************************
> ****
. **care home
. encode care_home_type, gen(carehometype)

. drop care_home_type

. 
. gen carehome=0

. replace carehome=1 if carehometype<4
(12,105 real changes made)

. safetab  carehometype carehome, m

carehomety |       carehome
        pe |         0          1 |     Total
-----------+----------------------+----------
        PC |         0      4,092 |     4,092 
        PN |         0      4,008 |     4,008 
        PS |         0      4,005 |     4,005 
         U |    66,955          0 |    66,955 
-----------+----------------------+----------
     Total |    66,955     12,105 |    79,060 

. 
. *check for missing household size values
. codebook  hh_size, d

------------------------------------------------------------------------------------
hh_size                                                                  (unlabeled)
------------------------------------------------------------------------------------

                  type:  numeric (byte)

                 range:  [3,12]                       units:  1
         unique values:  10                       missing .:  0/79,060

                  mean:    7.4993
              std. dev:    1.0372

           percentiles:        10%       25%       50%       75%       90%
                                 6         7         7         8         9

. 
. *gen categories of household size.
. gen hh_total_cat=.
(79,060 missing values generated)

. replace hh_total_cat=1 if hh_size >=1 & hh_size<=2
(0 real changes made)

. replace hh_total_cat=2 if hh_size >=3 & hh_size<=5
(1,683 real changes made)

. replace hh_total_cat=3 if hh_size >=6 & hh_size<=10
(77,270 real changes made)

. replace hh_total_cat=4 if hh_size>10 & hh_size!=.
(107 real changes made)

. replace hh_total_cat=9 if hh_size==0  //unknown
(0 real changes made)

. replace hh_total_cat=5 if carehome==1  
(12,105 real changes made)

. 
. 
. *who are people with missing household size
. safecount if hh_total_cat==.
  0

. safecount if hh_size==.
  0

. bysort  hh_total_cat: summ hh_size

------------------------------------------------------------------------------------
-> hh_total_cat = 2

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     hh_size |      1,397    4.931281     .258665          3          5

------------------------------------------------------------------------------------
-> hh_total_cat = 3

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     hh_size |     65,460    7.551986    .9659101          6         10

------------------------------------------------------------------------------------
-> hh_total_cat = 4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     hh_size |         98    11.08163     .275212         11         12

------------------------------------------------------------------------------------
-> hh_total_cat = 5

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     hh_size |     12,105    7.481784    1.045172          3         11


. 
. label define hh_total_cat 1 "1-2" ///
>                                                 2 "3-5" ///
>                                                 3 "6-10" ///
>                                                 4 "11+" ///
>                                                 5 "carehome" ///
>                                                 9 "Unknown"

.                                                                                   
>       
. label values hh_total_cat hh_total_cat

. 
. safetab hh_total_cat,m

hh_total_ca |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
        3-5 |      1,397        1.77        1.77
       6-10 |     65,460       82.80       84.56
        11+ |         98        0.12       84.69
   carehome |     12,105       15.31      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. safetab hh_total_cat carehome,m 

hh_total_c |       carehome
        at |         0          1 |     Total
-----------+----------------------+----------
       3-5 |     1,397          0 |     1,397 
      6-10 |    65,460          0 |    65,460 
       11+ |        98          0 |        98 
  carehome |         0     12,105 |    12,105 
-----------+----------------------+----------
     Total |    66,955     12,105 |    79,060 

. 
. *create second hh_total_cat excluding 11+ households for sensitivity analysis
. gen hh_cat_2=hh_total_cat

. replace hh_cat_2=. if hh_total_cat==4
(98 real changes made, 98 to missing)

. label values  hh_cat_2 hh_total_cat

. 
. 
. *log linear household size
. gen hh_linear=hh_size if hh_size>=1 & hh_size!=.

. replace hh_linear=11 if hh_linear>=11 & hh_linear!=.
(8 real changes made)

. gen hh_log_linear=log(hh_linear)

. sum hh_log_linear hh_linear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
hh_log_lin~r |     79,060    2.004951    .1417681   1.098612   2.397895
   hh_linear |     79,060    7.499203    1.036813          3         11

. 
. 
. /* CONVERT STRINGS TO DATE====================================================*/
. /* Comorb dates dates are given with month only, so adding day 
> 15 to enable  them to be processed as dates                       */
. 
. *cr date for diabetes based on adjudicated type
. gen diabetes=type1_diabetes if diabetes_type=="T1DM"
(78,558 missing values generated)

. replace diabetes=type2_diabetes if diabetes_type=="T2DM"
(3,140 real changes made)

. replace diabetes=unknown_diabetes if diabetes_type=="UNKNOWN_DM"
(275 real changes made)

. 
. drop type1_diabetes type2_diabetes unknown_diabetes

. 
. foreach var of varlist  chronic_respiratory_disease ///
>                                                 chronic_cardiac_disease  ///
>                                                 cancer  ///
>                                                 permanent_immunodeficiency  ///
>                                                 temporary_immunodeficiency  ///
>                                                 chronic_liver_disease  ///
>                                                 other_neuro  ///
>                                                 stroke                  ///
>                                                 dementia ///
>                                                 esrf  ///
>                                                 hypertension  ///
>                                                 ra_sle_psoriasis  ///
>                                                 diabetes ///
>                                                 bmi_date_measured   ///
>                                                 bp_sys_date_measured   ///
>                                                 bp_dias_date_measured   ///
>                                                 creatinine_date  ///
>                                                 hba1c_mmol_per_mol_date  ///
>                                                 hba1c_percentage_date ///
>                                                 smoking_status_date ///
>                                                 insulin ///
>                                                 statin ///
>                                                 ace_inhibitors ///
>                                                 arbs ///
>                                                 alpha_blockers ///
>                                                 betablockers ///
>                                                 calcium_channel_blockers ///
>                                                 spironolactone  ///
>                                                 thiazide_diuretics ///            
>                               
>                                                 {
  2.                                                         
.                 capture confirm string variable `var'
  3.                 if _rc!=0 {
  4.                         cap assert `var'==.
  5.                         rename `var' `var'_date
  6.                 }
  7.         
.                 else {
  8.                                 replace `var' = `var' + "-15"
  9.                                 rename `var' `var'_dstr
 10.                                 replace `var'_dstr = " " if `var'_dstr == "-15"
 11.                                 gen `var'_date = date(`var'_dstr, "YMD") 
 12.                                 order `var'_date, after(`var'_dstr)
 13.                                 drop `var'_dstr
 14.                 }
 15.         
.         format `var'_date %td
 16. }
variable chronic_respiratory_disease was str7 now str10
(79,060 real changes made)
(63,207 real changes made)
(63,207 missing values generated)
variable chronic_cardiac_disease was str7 now str10
(79,060 real changes made)
(63,271 real changes made)
(63,271 missing values generated)
variable cancer was str7 now str10
(79,060 real changes made)
(63,256 real changes made)
(63,256 missing values generated)
variable permanent_immunodeficiency was str7 now str10
(79,060 real changes made)
(63,386 real changes made)
(63,386 missing values generated)
variable temporary_immunodeficiency was str7 now str10
(79,060 real changes made)
(63,230 real changes made)
(63,230 missing values generated)
variable chronic_liver_disease was str7 now str10
(79,060 real changes made)
(63,267 real changes made)
(63,267 missing values generated)
variable other_neuro was str7 now str10
(79,060 real changes made)
(63,218 real changes made)
(63,218 missing values generated)
variable stroke was str7 now str10
(79,060 real changes made)
(63,281 real changes made)
(63,281 missing values generated)
variable dementia was str7 now str10
(79,060 real changes made)
(63,233 real changes made)
(63,233 missing values generated)
variable esrf was str7 now str10
(79,060 real changes made)
(63,232 real changes made)
(63,232 missing values generated)
variable hypertension was str7 now str10
(79,060 real changes made)
(63,251 real changes made)
(63,251 missing values generated)
variable ra_sle_psoriasis was str7 now str10
(79,060 real changes made)
(63,171 real changes made)
(63,171 missing values generated)
variable diabetes was str7 now str10
(79,060 real changes made)
(75,143 real changes made)
(75,143 missing values generated)
variable bmi_date_measured was str7 now str10
(79,060 real changes made)
(3,972 real changes made)
(3,972 missing values generated)
variable bp_sys_date_measured was str7 now str10
(79,060 real changes made)
(3,932 real changes made)
(3,932 missing values generated)
variable bp_dias_date_measured was str7 now str10
(79,060 real changes made)
(3,954 real changes made)
(3,954 missing values generated)
variable creatinine_date was str7 now str10
(79,060 real changes made)
(4,034 real changes made)
(4,034 missing values generated)
variable hba1c_mmol_per_mol_date was str7 now str10
(79,060 real changes made)
(3,967 real changes made)
(3,967 missing values generated)
variable hba1c_percentage_date was str7 now str10
(79,060 real changes made)
(3,900 real changes made)
(3,900 missing values generated)
variable smoking_status_date was str7 now str10
(79,060 real changes made)
(63,390 real changes made)
(63,390 missing values generated)
variable insulin was str7 now str10
(79,060 real changes made)
(63,176 real changes made)
(63,176 missing values generated)
variable statin was str7 now str10
(79,060 real changes made)
(63,291 real changes made)
(63,291 missing values generated)

. 
. * Note - outcome dates are handled separtely below 
. 
. * Some names too long for loops below, shorten
. rename permanent_immunodeficiency_date  perm_immunodef_date

. rename temporary_immunodeficiency_date  temp_immunodef_date

. rename bmi_date_measured_date                   bmi_measured_date

. 
. /* CREATE BINARY VARIABLES====================================================*/
. *  Make indicator variables for all conditions where relevant 
. 
. foreach var of varlist  chronic_respiratory_disease ///
>                                                 chronic_cardiac_disease  ///
>                                                 cancer  ///
>                                                 perm_immunodef  ///
>                                                 temp_immunodef  ///
>                                                 chronic_liver_disease  ///
>                                                 other_neuro  ///
>                                                 stroke                  ///
>                                                 dementia ///
>                                                 esrf  ///
>                                                 hypertension  ///
>                                                 ra_sle_psoriasis  ///
>                                                 bmi_measured_date   ///
>                                                 bp_sys_date_measured   ///
>                                                 bp_dias_date_measured   ///
>                                                 creatinine_date  ///
>                                                 hba1c_mmol_per_mol_date  ///
>                                                 hba1c_percentage_date ///
>                                                 smoking_status_date ///
>                                                 insulin ///
>                                                 statin ///
>                                                 ace_inhibitors ///
>                                                 arbs ///
>                                                 alpha_blockers ///
>                                                 betablockers ///
>                                                 calcium_channel_blockers ///
>                                                 spironolactone  ///
>                                                 thiazide_diuretics ///            
>                               
>                                                 {
  2.                                                 
.         /* date ranges are applied in python, so presence of date indicates presen
> ce of 
>           disease in the correct time frame */ 
.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5.         safetab `newvar', m
  6.         
. }

chronic_res |
piratory_di |
      sease |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,207       79.95       79.95
          1 |     15,853       20.05      100.00
------------+-----------------------------------
      Total |     79,060      100.00

chronic_car |
diac_diseas |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,271       80.03       80.03
          1 |     15,789       19.97      100.00
------------+-----------------------------------
      Total |     79,060      100.00

     cancer |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,256       80.01       80.01
          1 |     15,804       19.99      100.00
------------+-----------------------------------
      Total |     79,060      100.00

perm_immuno |
        def |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,386       80.17       80.17
          1 |     15,674       19.83      100.00
------------+-----------------------------------
      Total |     79,060      100.00

temp_immuno |
        def |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,230       79.98       79.98
          1 |     15,830       20.02      100.00
------------+-----------------------------------
      Total |     79,060      100.00

chronic_liv |
 er_disease |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,267       80.02       80.02
          1 |     15,793       19.98      100.00
------------+-----------------------------------
      Total |     79,060      100.00

other_neuro |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,218       79.96       79.96
          1 |     15,842       20.04      100.00
------------+-----------------------------------
      Total |     79,060      100.00

     stroke |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,281       80.04       80.04
          1 |     15,779       19.96      100.00
------------+-----------------------------------
      Total |     79,060      100.00

   dementia |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,233       79.98       79.98
          1 |     15,827       20.02      100.00
------------+-----------------------------------
      Total |     79,060      100.00

       esrf |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,232       79.98       79.98
          1 |     15,828       20.02      100.00
------------+-----------------------------------
      Total |     79,060      100.00

hypertensio |
          n |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,251       80.00       80.00
          1 |     15,809       20.00      100.00
------------+-----------------------------------
      Total |     79,060      100.00

ra_sle_psor |
      iasis |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,171       79.90       79.90
          1 |     15,889       20.10      100.00
------------+-----------------------------------
      Total |     79,060      100.00

bmi_measure |
          d |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,972        5.02        5.02
          1 |     75,088       94.98      100.00
------------+-----------------------------------
      Total |     79,060      100.00

bp_sys_date |
  _measured |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,932        4.97        4.97
          1 |     75,128       95.03      100.00
------------+-----------------------------------
      Total |     79,060      100.00

bp_dias_dat |
 e_measured |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,954        5.00        5.00
          1 |     75,106       95.00      100.00
------------+-----------------------------------
      Total |     79,060      100.00

creatinine_ |
       date |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      4,034        5.10        5.10
          1 |     75,026       94.90      100.00
------------+-----------------------------------
      Total |     79,060      100.00

hba1c_mmol_ |
per_mol_dat |
          e |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,967        5.02        5.02
          1 |     75,093       94.98      100.00
------------+-----------------------------------
      Total |     79,060      100.00

hba1c_perce |
 ntage_date |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,900        4.93        4.93
          1 |     75,160       95.07      100.00
------------+-----------------------------------
      Total |     79,060      100.00

smoking_sta |
   tus_date |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,390       80.18       80.18
          1 |     15,670       19.82      100.00
------------+-----------------------------------
      Total |     79,060      100.00

    insulin |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,176       79.91       79.91
          1 |     15,884       20.09      100.00
------------+-----------------------------------
      Total |     79,060      100.00

     statin |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,291       80.05       80.05
          1 |     15,769       19.95      100.00
------------+-----------------------------------
      Total |     79,060      100.00

ace_inhibit |
        ors |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     55,421       70.10       70.10
          1 |     23,639       29.90      100.00
------------+-----------------------------------
      Total |     79,060      100.00

       arbs |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     55,387       70.06       70.06
          1 |     23,673       29.94      100.00
------------+-----------------------------------
      Total |     79,060      100.00

alpha_block |
        ers |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     55,427       70.11       70.11
          1 |     23,633       29.89      100.00
------------+-----------------------------------
      Total |     79,060      100.00

betablocker |
          s |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     55,365       70.03       70.03
          1 |     23,695       29.97      100.00
------------+-----------------------------------
      Total |     79,060      100.00

calcium_cha |
nnel_blocke |
         rs |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     55,368       70.03       70.03
          1 |     23,692       29.97      100.00
------------+-----------------------------------
      Total |     79,060      100.00

spironolact |
        one |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     55,265       69.90       69.90
          1 |     23,795       30.10      100.00
------------+-----------------------------------
      Total |     79,060      100.00

thiazide_di |
    uretics |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     55,331       69.99       69.99
          1 |     23,729       30.01      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. 
. /*  Body Mass Index  */
. * NB: watch for missingness
. 
. * Recode strange values 
. replace bmi = . if bmi == 0 
(0 real changes made)

. replace bmi = . if !inrange(bmi, 15, 50)
(6,816 real changes made, 6,816 to missing)

. 
. * Restrict to within 10 years of index and aged > 16 
. gen bmi_time = (indexdate - bmi_measured_date)/365.25
(3,972 missing values generated)

. gen bmi_age = age - bmi_time
(3,972 missing values generated)

. 
. replace bmi = . if bmi_age < 16 
(3,229 real changes made, 3,229 to missing)

. replace bmi = . if bmi_time > 10 & bmi_time != . 
(0 real changes made)

. 
. * Set to missing if no date, and vice versa 
. replace bmi = . if bmi_measured_date == . 
(0 real changes made)

. replace bmi_measured_date = . if bmi == . 
(10,045 real changes made, 10,045 to missing)

. replace bmi_measured = . if bmi == . 
(14,017 real changes made, 14,017 to missing)

. 
. * BMI (NB: watch for missingness)
. gen     bmicat = .
(79,060 missing values generated)

. recode  bmicat . = 1 if bmi<18.5
(bmicat: 1893 changes made)

. recode  bmicat . = 2 if bmi<25
(bmicat: 7620 changes made)

. recode  bmicat . = 3 if bmi<30
(bmicat: 10705 changes made)

. recode  bmicat . = 4 if bmi<35
(bmicat: 13794 changes made)

. recode  bmicat . = 5 if bmi<40
(bmicat: 13853 changes made)

. recode  bmicat . = 6 if bmi<.
(bmicat: 17178 changes made)

. replace bmicat = .u if bmi>=.
(14,017 real changes made, 14,017 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                     //
> /
>                                         .u "Unknown (.u)"

. label values bmicat bmicat

. 
. * Create more granular categorisation
. recode bmicat 1/3 .u = 1 4=2 5=3 6=4, gen(obese4cat)
(77167 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"           //
> /
>                                                 3 "Obese II (35-39.9)"          //
> /
>                                                 4 "Obese III (40+)"             

. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. 
. 
. 
. **generate BMI categories for south asians
. *https://www.nice.org.uk/guidance/ph46/chapter/1-Recommendations#recommendation-2-
> bmi-assessment-multi-component-interventions-and-best-practice-standards
. 
. gen bmicat_sa=bmicat
(14,017 missing values generated)

. replace bmicat_sa = 2 if bmi>=18.5 & bmi <23 & eth5==2
(0 real changes made)

. replace bmicat_sa = 3 if bmi>=23 & bmi < 27.5 & eth5==2
(449 real changes made)

. replace bmicat_sa = 4 if bmi>=27.5 & bmi < 32.5 & eth5==2
(877 real changes made)

. replace bmicat_sa = 5 if bmi>=32.5 & bmi < 37.5 & eth5==2
(1,093 real changes made)

. replace bmicat_sa = 6 if bmi>=37.5 & bmi < . & eth5==2
(985 real changes made)

. replace bmicat_sa = 7 if bmi==.
(14,017 real changes made)

. 
. safetab bmicat_sa

  bmicat_sa |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      1,893        2.39        2.39
          2 |      7,171        9.07       11.46
          3 |     10,277       13.00       24.46
          4 |     13,578       17.17       41.64
          5 |     13,961       17.66       59.30
          6 |     18,163       22.97       82.27
          7 |     14,017       17.73      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. label define bmicat_sa 1 "Underweight (<18.5)"  ///
>                                         2 "Normal (18.5-24.9 / 22.9)"           //
> /
>                                         3 "Overweight (25-29.9 / 23-27.4)"      //
> /
>                                         4 "Obese I (30-34.9 / 27.4-32.4)"         
>       ///
>                                         5 "Obese II (35-39.9 / 32.5- 37.4)"       
>       ///
>                                         6 "Obese III (40+ / 37.5+)"               
>       ///
>                                         7 "Unknown"

. label values bmicat_sa bmicat_sa

. 
. * Create more granular categorisation
. recode bmicat_sa 1/3 .u = 1 4=2 5=3 6=4, gen(obese4cat_sa)
(63150 differences between bmicat_sa and obese4cat_sa)

. 
. label define obese4cat_sa       1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9 / 27.5-32.5)" 
>               ///
>                                                 3 "Obese II (35-39.9 / 32.5- 37.4)
> "             ///
>                                                 4 "Obese III (40+ / 37.5+)"       
>       

. label values obese4cat_sa obese4cat_sa

. order obese4cat_sa, after(bmicat_sa)

. 
. 
. /*  Smoking  */
. 
. * Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Unknown (.u)"

. 
. gen     smoke = 1  if smoking_status == "N"
(75,899 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(1,614 real changes made)

. replace smoke = 3  if smoking_status == "S"
(9,347 real changes made)

. replace smoke = .u if smoking_status == "M"
(1,639 real changes made, 1,639 to missing)

. replace smoke = .u if smoking_status == "" 
(63,299 real changes made, 63,299 to missing)

. 
. label values smoke smoke

. drop smoking_status

. 
. * Create non-missing 3-category variable for current smoking
. * Assumes missing smoking is never smoking 
. recode smoke .u = 1, gen(smoke_nomiss)
(64938 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. /* CLINICAL COMORBIDITIES */ 
. 
. /*  Cancer */
. label define cancer 1 "Never" 2 "Last year" 3 "2-5 years ago" 4 "5+ years"

. 
. * malignancies
. gen     cancer_cat = 4 if inrange(cancer_date, d(1/1/1900), d(1/2/2015))
(64,966 missing values generated)

. replace cancer_cat = 3 if inrange(cancer_date, d(1/2/2015), d(1/2/2019))
(1,245 real changes made)

. replace cancer_cat = 2 if inrange(cancer_date, d(1/2/2019), d(1/2/2020))
(307 real changes made)

. recode  cancer_cat . = 1
(cancer_cat: 63414 changes made)

. label values cancer_cat cancer

. 
. /*  Immunosuppression  */
. 
. * Immunosuppressed:
. * Permanent immunodeficiency ever, OR 
. * Temporary immunodeficiency  last year
. gen temp1  = 1 if perm_immunodef_date!=.
(63,386 missing values generated)

. gen temp2  = inrange(temp_immunodef_date, (indexdate - 365), indexdate)

. 
. 
. gen immunosuppressed=0

. replace immunosuppressed=1 if perm_immunodef==1 | temp_immunodef==1
(28,367 real changes made)

. safetab immunosuppressed

immunosuppr |
      essed |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     50,693       64.12       64.12
          1 |     28,367       35.88      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. /*  Blood pressure   */
. 
. /*set implausible BP values to missing
> https://onlinelibrary.wiley.com/doi/full/10.1111/jch.12743
> SBP (DBP) values outside of the range of 50–300 (30–250) mm Hg were considered imp
> lausible and threrefore excluded. */
. 
. replace bp_sys=. if bp_sys<50 | bp_sys>300
(100 real changes made, 100 to missing)

. replace bp_dias=. if bp_dias<30 | bp_dias>250
(0 real changes made)

. 
. * Categorise
. gen     bpcat = 1 if bp_sys < 120 &  bp_dias < 80
(79,058 missing values generated)

. replace bpcat = 2 if inrange(bp_sys, 120, 130) & bp_dias<80
(0 real changes made)

. replace bpcat = 3 if inrange(bp_sys, 130, 140) | inrange(bp_dias, 80, 90)
(96 real changes made)

. replace bpcat = 4 if (bp_sys>=140 & bp_sys<.) | (bp_dias>=90 & bp_dias<.) 
(75,007 real changes made)

. replace bpcat = 5 if bp_sys>=. | bp_dias>=. | bp_sys==0 | bp_dias==0
(7,779 real changes made)

. 
. label define bpcat 1 "Normal" 2 "Elevated" 3 "High, stage I"    ///
>                                         4 "High, stage II" 5 "Unknown"

. label values bpcat bpcat

. 
. recode bpcat 5=1, gen(bpcat_nomiss)
(7779 differences between bpcat and bpcat_nomiss)

. label values bpcat_nomiss bpcat

. 
. * Create non-missing indicator of known high blood pressure
. gen bphigh = (bpcat==4)

. 
. /*  Hypertension  */
. 
. gen htdiag_or_highbp = bphigh

. recode htdiag_or_highbp 0 = 1 if hypertension==1 
(htdiag_or_highbp: 1603 changes made)

. 
. 
. 
. *Mean arterial pressure MAP = (SBP+(DBP*2))/3
. gen bp_map=(bp_sys + (bp_dias*2))/3
(7,779 missing values generated)

. 
. ren bpcat bp_cat

. ************
. *   eGFR   *
. ************
. 
. * Set implausible creatinine values to missing (Note: zero changed to missing)
. replace creatinine = . if !inrange(creatinine, 20, 3000) 
(285 real changes made, 285 to missing)

.         
. * Divide by 88.4 (to convert umol/l to mg/dl)
. gen SCr_adj = creatinine/88.4
(4,319 missing values generated)

. 
. gen min=.
(79,060 missing values generated)

. replace min = SCr_adj/0.7 if male==0
(37,952 real changes made)

. replace min = SCr_adj/0.9 if male==1
(36,789 real changes made)

. replace min = min^-0.329  if male==0
(37,952 real changes made)

. replace min = min^-0.411  if male==1
(36,789 real changes made)

. replace min = 1 if min<1
(20,682 real changes made)

. 
. gen max=.
(79,060 missing values generated)

. replace max=SCr_adj/0.7 if male==0
(37,952 real changes made)

. replace max=SCr_adj/0.9 if male==1
(36,789 real changes made)

. replace max=max^-1.209
(74,741 real changes made)

. replace max=1 if max>1
(58,378 real changes made)

. 
. gen egfr=min*max*141
(4,319 missing values generated)

. replace egfr=egfr*(0.993^age)
(74,741 real changes made)

. replace egfr=egfr*1.018 if male==0
(37,952 real changes made)

. label var egfr "egfr calculated using CKD-EPI formula with no eth"

. 
. * Categorise into ckd stages
. egen egfr_cat = cut(egfr), at(0, 30, 60, 5000)
(4,319 missing values generated)

. 
. label define egfr_cat 5000 "None" 60 "Stage 3 egfr 30-6" 30 "Stage 4/5 egfr<30"

. label values egfr_cat egfr_cat 

. lab var  egfr_cat "CKD category"

. safetab egfr_cat

     CKD category |      Freq.     Percent        Cum.
------------------+-----------------------------------
Stage 4/5 egfr<30 |        910        1.22        1.22
Stage 3 egfr 30-6 |     73,831       98.78      100.00
------------------+-----------------------------------
            Total |     74,741      100.00

. 
. gen egfr60=0

. replace egfr60=1 if egfr<60
(910 real changes made)

. lab define egfr60 0"egfr >=60" 1"eGFR <60"

. label values egfr60 egfr60

. tab egfr60

     egfr60 |      Freq.     Percent        Cum.
------------+-----------------------------------
  egfr >=60 |     78,150       98.85       98.85
   eGFR <60 |        910        1.15      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. /* Hb1AC */
. 
. /*  Diabetes severity  */
. 
. * Set zero or negative to missing
. replace hba1c_percentage   = . if hba1c_percentage <= 0
(473 real changes made, 473 to missing)

. replace hba1c_mmol_per_mol = . if hba1c_mmol_per_mol <= 0
(1,754 real changes made, 1,754 to missing)

. 
. /* Express  HbA1c as percentage  */ 
. 
. * Express all values as perecentage 
. noi summ hba1c_percentage hba1c_mmol_per_mol 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
hba1c_per~ge |     74,687    5.032016    1.949941   .0010402   12.86992
hba1c_mmol~l |     73,339    41.11745    18.87616   .0051369   122.7962

. gen     hba1c_pct = hba1c_percentage 
(4,373 missing values generated)

. replace hba1c_pct = (hba1c_mmol_per_mol/10.929)+2.15 if hba1c_mmol_per_mol<. 
(73,339 real changes made)

. 
. * Valid % range between 0-20  /195 mmol/mol
. replace hba1c_pct = . if !inrange(hba1c_pct, 0, 20) 
(0 real changes made)

. replace hba1c_pct = round(hba1c_pct, 0.1)
(78,773 real changes made)

. 
. 
. /* Categorise hba1c and diabetes  */
. /* Diabetes type */
. gen dm_type=1 if diabetes_type=="T1DM"
(76,674 missing values generated)

. replace dm_type=2 if diabetes_type=="T2DM"
(15,853 real changes made)

. replace dm_type=3 if diabetes_type=="UNKNOWN_DM"
(1,519 real changes made)

. replace dm_type=0 if diabetes_type=="NO_DM"
(59,302 real changes made)

. 
. safetab dm_type diabetes_type

           |                diabetes_type
   dm_type |     NO_DM       T1DM       T2DM  UNKNOWN.. |     Total
-----------+--------------------------------------------+----------
         0 |    59,302          0          0          0 |    59,302 
         1 |         0      2,386          0          0 |     2,386 
         2 |         0          0     15,853          0 |    15,853 
         3 |         0          0          0      1,519 |     1,519 
-----------+--------------------------------------------+----------
     Total |    59,302      2,386     15,853      1,519 |    79,060 

. label define dm_type 0"No DM" 1"T1DM" 2"T2DM" 3"UNKNOWN_DM"

. label values dm_type dm_type

. 
. *Open safely diabetes codes with exeter algorithm
. gen dm_type_exeter_os=1 if diabetes_exeter_os=="T1DM_EX_OS"
(76,752 missing values generated)

. replace dm_type_exeter_os=2 if diabetes_exeter_os=="T2DM_EX_OS"
(15,839 real changes made)

. replace dm_type_exeter_os=0 if diabetes_exeter_os=="NO_DM"
(60,913 real changes made)

. label values  dm_type_exeter_os dm_type

. 
. * Group hba1c
. gen     hba1ccat = 0 if hba1c_pct <  6.5
(28,785 missing values generated)

. replace hba1ccat = 1 if hba1c_pct >= 6.5  & hba1c_pct < 7.5
(14,014 real changes made)

. replace hba1ccat = 2 if hba1c_pct >= 7.5  & hba1c_pct < 8
(5,003 real changes made)

. replace hba1ccat = 3 if hba1c_pct >= 8    & hba1c_pct < 9
(6,044 real changes made)

. replace hba1ccat = 4 if hba1c_pct >= 9    & hba1c_pct !=.
(3,437 real changes made)

. replace hba1ccat = 5 if hba1c_pct==.
(287 real changes made)

. label define hba1ccat 0 "<6.5%" 1">=6.5-7.4" 2">=7.5-7.9" 3">=8-8.9" 4">=9" 5"Unkn
> own"

. label values hba1ccat hba1ccat

. safetab hba1ccat

   hba1ccat |      Freq.     Percent        Cum.
------------+-----------------------------------
      <6.5% |     50,275       63.59       63.59
  >=6.5-7.4 |     14,014       17.73       81.32
  >=7.5-7.9 |      5,003        6.33       87.64
    >=8-8.9 |      6,044        7.64       95.29
        >=9 |      3,437        4.35       99.64
    Unknown |        287        0.36      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. gen hba1c75=0 if hba1c_pct<7.5
(14,771 missing values generated)

. replace hba1c75=1 if hba1c_pct>=7.5 & hba1c_pct!=.
(14,484 real changes made)

. label define hba1c75 0"<7.5" 1">=7.5"

. safetab hba1c75, m

    hba1c75 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     64,289       81.32       81.32
          1 |     14,484       18.32       99.64
          . |        287        0.36      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. * Create diabetes, split by control/not
. gen     diabcat = 1 if dm_type==0
(19,758 missing values generated)

. replace diabcat = 2 if dm_type==1 & inlist(hba1ccat, 0, 1)
(1,952 real changes made)

. replace diabcat = 3 if dm_type==1 & inlist(hba1ccat, 2, 3, 4)
(423 real changes made)

. replace diabcat = 4 if dm_type==2 & inlist(hba1ccat, 0, 1)
(12,893 real changes made)

. replace diabcat = 5 if dm_type==2 & inlist(hba1ccat, 2, 3, 4)
(2,905 real changes made)

. replace diabcat = 6 if dm_type==1 & hba1c_pct==. | dm_type==2 & hba1c_pct==.
(66 real changes made)

. 
. 
. label define diabcat    1 "No diabetes"                         ///
>                                                 2 "T1DM, controlled"            //
> /
>                                                 3 "T1DM, uncontrolled"          //
> /
>                                                 4 "T2DM, controlled"            //
> /
>                                                 5 "T2DM, uncontrolled"          //
> /
>                                                 6 "Diabetes, no HbA1c"

. label values diabcat diabcat

. safetab diabcat, m

           diabcat |      Freq.     Percent        Cum.
-------------------+-----------------------------------
       No diabetes |     59,302       75.01       75.01
  T1DM, controlled |      1,952        2.47       77.48
T1DM, uncontrolled |        423        0.54       78.01
  T2DM, controlled |     12,893       16.31       94.32
T2DM, uncontrolled |      2,905        3.67       98.00
Diabetes, no HbA1c |         66        0.08       98.08
                 . |      1,519        1.92      100.00
-------------------+-----------------------------------
             Total |     79,060      100.00

. 
. /*  Asthma  */
. * Asthma  (coded: 0 No, 1 Yes no OCS, 2 Yes with OCS)
. safetab asthma

     asthma |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     12,617       80.06       80.06
          1 |      1,579       10.02       90.08
          2 |      1,563        9.92      100.00
------------+-----------------------------------
      Total |     15,759      100.00

. replace asthma=0 if asthma==.
(63,301 real changes made)

. replace asthma=1 if asthma==2
(1,563 real changes made)

. safetab asthma

     asthma |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     75,918       96.03       96.03
          1 |      3,142        3.97      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. *gen count of co-morbidities
. gen comorbidity_count=0

. 
. foreach var of varlist  chronic_respiratory_disease ///
>                                                 chronic_cardiac_disease  ///
>                                                 cancer  ///
>                                                 perm_immunodef  ///
>                                                 temp_immunodef  ///
>                                                 chronic_liver_disease  ///
>                                                 other_neuro  ///
>                                                 stroke                  ///
>                                                 dementia ///
>                                                 esrf  ///
>                                                 hypertension  ///
>                                                 asthma ///
>                                                 ra_sle_psoriasis  ///
>                                                 {
  2. replace comorbidity_count=comorbidity_count+1 if `var'==1
  3.                                                 }
(15,853 real changes made)
(15,789 real changes made)
(15,804 real changes made)
(15,674 real changes made)
(15,830 real changes made)
(15,793 real changes made)
(15,842 real changes made)
(15,779 real changes made)
(15,827 real changes made)
(15,828 real changes made)
(15,809 real changes made)
(3,142 real changes made)
(15,889 real changes made)

. 
. summ comorbidity_count

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
comorbidit~t |     79,060      2.4394    1.399191          0         10

. 
. *comorbidities category 
. gen comorbidity_cat =comorbidity_count

. replace comorbidity_cat=4 if comorbidity_count>=4 & comorbidity_count!=.
(6,151 real changes made)

. bysort comorbidity_cat: sum comorbidity_count

------------------------------------------------------------------------------------
-> comorbidity_cat = 0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
comorbidi~nt |      5,285           0           0          0          0

------------------------------------------------------------------------------------
-> comorbidity_cat = 1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
comorbidi~nt |     15,684           1           0          1          1

------------------------------------------------------------------------------------
-> comorbidity_cat = 2

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
comorbidi~nt |     22,234           2           0          2          2

------------------------------------------------------------------------------------
-> comorbidity_cat = 3

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
comorbidi~nt |     19,029           3           0          3          3

------------------------------------------------------------------------------------
-> comorbidity_cat = 4

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
comorbidi~nt |     16,828    4.493701    .7530502          4         10


. safetab comorbidity_cat,m

comorbidity |
       _cat |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      5,285        6.68        6.68
          1 |     15,684       19.84       26.52
          2 |     22,234       28.12       54.65
          3 |     19,029       24.07       78.71
          4 |     16,828       21.29      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. *******************************
. *  Recode implausible values  *
. *******************************
. 
. *make combination_bp_meds binary
. safetab combination_bp_meds

**TABLE OF combination_bp_meds REDACTED DUE TO SMALL N**


. replace combination_bp_meds=0 if combination_bp_meds<0 
(517 real changes made)

. replace combination_bp_meds=1 if combination_bp_meds>0 & combination_bp_meds!=.
(16,459 real changes made)

. safetab combination_bp_meds

combination |
   _bp_meds |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |      3,799       15.97       15.97
          1 |     19,994       84.03      100.00
------------+-----------------------------------
      Total |     23,793      100.00

. 
. * BMI 
. * Set implausible BMIs to missing:
. replace bmi = . if !inrange(bmi, 15, 50)
(0 real changes made)

. 
. *GP consult count
. replace gp_consult_count=0 if gp_consult_count==. | gp_consult_count<0
(24,131 real changes made)

. summ gp_consult_count

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
gp_consult~t |     79,060    2.467784      2.2985          0         12

. 
. /**** Create survival times  ****/
. * For looping later, name must be stime_binary_outcome_name
. 
. * Survival time = last followup date (first: deregistration date, end study, death
> , or that outcome)
. *Ventilation does not have a survival time because it is a yes/no flag
. foreach i of global outcomes {
  2.         gen stime_`i' = min(`i'_censor_date, onsdeath_date, `i'_date, dereg_dat
> e)
  3. }

. 
. * If outcome occurs after censoring, set to zero
. foreach i of global outcomes {
  2.         replace `i'=0 if `i'_date>stime_`i'
  3.         tab `i'
  4. }
(14,168 real changes made)

     tested |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     29,943       37.87       37.87
          1 |     49,117       62.13      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(14,025 real changes made)

positivetes |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     29,870       37.78       37.78
          1 |     49,190       62.22      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(4,355 real changes made)

        hes |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,537       80.37       80.37
          1 |     15,523       19.63      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(12,279 real changes made)

        icu |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     75,502       95.50       95.50
          1 |      3,558        4.50      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(673 real changes made)

onscoviddea |
         th |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     74,838       94.66       94.66
          1 |      4,222        5.34      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(1,946 real changes made)

ons_noncovi |
     ddeath |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     66,195       83.73       83.73
          1 |     12,865       16.27      100.00
------------+-----------------------------------
      Total |     79,060      100.00
(2,619 real changes made)

   onsdeath |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     61,973       78.39       78.39
          1 |     17,087       21.61      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. 
. * Format date variables
. format  stime* %td 

. 
. /*distribution of outcome dates
> foreach i of global outcomes {
>         histogram `i'_date, discrete width(15) frequency ytitle(`i') xtitle(Date) 
> scheme(meta) 
> graph export "$Tabfigdir/outcome_`i'_freq.svg", as(svg) replace
> }
> */
. /* LABEL VARIABLES============================================================*/
. *  Label variables you are intending to keep, drop the rest 
. 
. *HH variable
. label var  hh_size "# people in household"

. label var  hh_id "Household ID"

. label var hh_total "# people in household calculated"

. label var hh_total_cat "Number of people in household"

. label var hh_log_linear "Log linear household size"

. label var hh_linear "Linear household size"

. label var hh_cat_2 "Household carehome excluding 11+"

. label var is_prison "Household status is a prison"

. 
. * Demographics
. label var patient_id                            "Patient ID"

. label var age                                           "Age (years)"

. label var agegroup                                      "Grouped age"

. label var sex                                           "Sex"

. label var male                                          "Male"

. label var bmi                                           "Body Mass Index (BMI, kg/
> m2)"

. label var bmicat                                        "BMI"

. label var bmicat_sa                                     "BMI with SA categories"

. label var bmi_measured_date             "Body Mass Index (BMI, kg/m2), date measur
> ed"

. label var obese4cat                                     "Obesity (4 categories)"

. label var obese4cat_sa                          "Obesity with SA categories"

. label var smoke                                         "Smoking status"

. label var smoke_nomiss                          "Smoking status (missing set to no
> n)"

. label var imd                                           "Index of Multiple Depriva
> tion (IMD)"

. label var eth5                                          "Eth 5 categories"

. label var ethnicity_16                          "Eth 16 categories"

. label var eth16                                         "Eth 16 collapsed"

. label var stp                                           "Sustainability and Transf
> ormation Partnership"

. label var age1                                          "Age spline 1"

. label var age2                                          "Age spline 2"

. label var age3                                          "Age spline 3"

. lab var region                                          "Region of England"

. lab var rural_urban                                     "Rural-Urban Indicator"

. lab var carehome                                        "Care home y/n"

. lab var hba1c_mmol_per_mol                      "HbA1c mmo/mol"

. lab var hba1c_pct                                       "HbA1c %"

. lab var hba1ccat                                        "HbA1c category"

. lab var hba1c75                                         "HbA1c >= 7.5%"

. lab var gp_consult_count                        "Number of GP consultations in the
>  12 months prior to baseline"

. 
. * Comorbidities of interest 
. label var comorbidity_count                     "Count of co-morbid conditions"

. label var comorbidity_cat                               "Catgeorised co-morbidity 
> count"

. label var asthma                                                "Asthma category"

. label var hypertension                              "Diagnosed hypertension"

. label var chronic_respiratory_disease   "Chronic Respiratory Diseases"

. label var chronic_cardiac_disease               "Chronic Cardiac Diseases"

. label var dm_type                                               "Diabetes Type"

. label var dm_type_exeter_os                             "Diabetes type (Exeter def
> inition)"

. label var cancer                                                "Cancer"

. label var immunosuppressed                              "Immunosuppressed (perm or
>  temp)"

. label var chronic_liver_disease                 "Chronic liver disease"

. label var other_neuro                                   "Neurological disease"    
>               

. label var stroke                                            "Stroke"

. lab var dementia                                                "Dementia"        
>                                               

. label var ra_sle_psoriasis                              "Autoimmune disease"

. lab var egfr                                                    "eGFR"

. lab var egfr_cat                                                "CKD category defi
> ned by eGFR"

. lab var egfr60                                                  "CKD defined by eg
> fr<60"

. lab var  bphigh                                                 "non-missing indic
> ator of known high blood pressure"

. lab var bp_cat                                                  "Blood pressure fo
> ur levels non-missing"

. lab var htdiag_or_highbp                                "High blood pressure or hy
> pertension diagnosis"

. lab var bp_sys                                                  "Systolic BP"

. lab var bp_dias                                                 "Diastolic BP"

. lab var bp_map                                                  "Mean Arterial Pre
> ssure"

. lab var esrf                                                    "end stage renal f
> ailure"

. label var hypertension_date                                     "Diagnosed hyperte
> nsion Date"

. label var chronic_respiratory_disease_date      "Other Respiratory Diseases Date"

. label var chronic_cardiac_disease_date          "Other Heart Diseases Date"

. label var diabetes_date                                         "Diabetes Date"

. label var cancer_date                                           "Cancer Date"

. label var chronic_liver_disease_date            "Chronic liver disease Date"

. label var other_neuro_date                                      "Neurological dise
> ase  Date"

. label var stroke_date                                   "Stroke date"           

. label var dementia_date                                         "DDementia date"  
>                                       

. label var ra_sle_psoriasis_date                         "Autoimmune disease  Date"

. lab var esrf_date                                                       "end stage
>  renal failure"

. lab var hba1c_percentage_date                           "HbA1c % date"

. 
. 
. *medications
. lab var statin                                                          "Statin in
>  last 12 months"

. lab var insulin                                                         "Insulin i
> n last 12 months"

. lab var ace_inhibitors                                          "ACE in last 12 mo
> nths"

. lab var alpha_blockers                                          "Alpha blocker in 
> last 12 months"

. lab var arbs                                                            "ARB in la
> st 12 months"

. lab var betablockers                                            "Beta blocker in l
> ast 12 months"

. lab var calcium_channel_blockers                        "CCB in last 12 months"

. lab var combination_bp_meds                             "BP med in last 12 months"

. lab var spironolactone                                          "Spironolactone in
>  last 12 months"

. lab var thiazide_diuretics                                      "TZD in last 12 mo
> nths"

. 
. lab var statin_date                                                     "Statin in
>  last 12 months"

. lab var insulin_date                                            "Insulin in last 1
> 2 months"

. lab var ace_inhibitors_date                             "ACE in last 12 months"

. lab var alpha_blockers_date                             "Alpha blocker in last 12 
> months"

. lab var arbs_date                                                       "ARB in la
> st 12 months"

. lab var betablockers_date                                       "Beta blocker in l
> ast 12 months"

. lab var calcium_channel_blockers_date           "CCB in last 12 months"

. lab var spironolactone_date                             "Spironolactone in last 12
>  months"

. lab var thiazide_diuretics_date                         "TZD in last 12 months"

. 
. * Outcomes and follow-up
. label var indexdate                                     "Date of study start (Feb 
> 1 2020)"

. foreach i of global outcomes {
  2.         label var `i'_censor_date                "Date of admin censoring"
  3. }

. *Outcome dates
. foreach i of global outcomes {
  2.         label var `i'_date                                      "Failure date: 
>  `i'"
  3.         d `i'_date
  4. }

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
tested_date     float   %td                   Failure date:  tested

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
positive~t_date float   %td                   Failure date:  positivetest

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
hes_date        float   %td                   Failure date:  hes

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
icu_date        float   %td                   Failure date:  icu

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
onscovid~h_date float   %td                   Failure date:  onscoviddeath

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
ons_nonc~h_date float   %td                   Failure date:  ons_noncoviddeath

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
onsdeath_date   float   %td                   Failure date:  onsdeath

. 
. * Survival times
. foreach i of global outcomes {
  2.         lab var stime_`i'                                       "Survivatime (d
> ate): `i'"
  3.         d stime_`i'
  4. }

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
stime_tested    float   %td                   Survivatime (date): tested

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
stime_positiv~t float   %td                   Survivatime (date): positivetest

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
stime_hes       float   %td                   Survivatime (date): hes

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
stime_icu       float   %td                   Survivatime (date): icu

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
stime_onscovi~h float   %td                   Survivatime (date): onscoviddeath

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
stime_ons_non~h float   %td                   Survivatime (date): ons_noncoviddeath

              storage   display    value
variable name   type    format     label      variable label
------------------------------------------------------------------------------------
stime_onsdeath  float   %td                   Survivatime (date): onsdeath

. 
. * binary outcome indicators
. foreach i of global outcomes {
  2.         lab var `i'                                     "outcome `i'"
  3.         safetab `i'
  4. }

    outcome |
     tested |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     29,943       37.87       37.87
          1 |     49,117       62.13      100.00
------------+-----------------------------------
      Total |     79,060      100.00

    outcome |
positivetes |
          t |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     29,870       37.78       37.78
          1 |     49,190       62.22      100.00
------------+-----------------------------------
      Total |     79,060      100.00

outcome hes |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     63,537       80.37       80.37
          1 |     15,523       19.63      100.00
------------+-----------------------------------
      Total |     79,060      100.00

outcome icu |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     75,502       95.50       95.50
          1 |      3,558        4.50      100.00
------------+-----------------------------------
      Total |     79,060      100.00

    outcome |
onscoviddea |
         th |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     74,838       94.66       94.66
          1 |      4,222        5.34      100.00
------------+-----------------------------------
      Total |     79,060      100.00

    outcome |
ons_noncovi |
     ddeath |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     66,195       83.73       83.73
          1 |     12,865       16.27      100.00
------------+-----------------------------------
      Total |     79,060      100.00

    outcome |
   onsdeath |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     61,973       78.39       78.39
          1 |     17,087       21.61      100.00
------------+-----------------------------------
      Total |     79,060      100.00

. label var advanced_resp_support_flag            "outcome: Advanced respiratory sup
> port"

. 
. label var basic_resp_support_flag               "outcome: Basic respiratory suppor
> t"

. label var any_resp_support_flag "outcome: Any respiratory support"

. 
. /* TIDY DATA==================================================================*/
. *  Drop variables that are not needed (those not labelled)
. ds, not(varlabel)
confirmed_~e  bp_sys_dat~e  smoki~e_date  died_ons_c~g  onsconfirm..  cancer_cat
primary_c~se  bp_sys_dat~d  smoki~s_date  ethnicity     onssuspect~e  temp1
primary_c~re  bp_dias_da~e  perm_immun~e  has_consul~y  dereg_date    temp2
suspected_~e  bp_dias_da~d  perm_immun~f  hba1c_per~ge  ae_censor_~e  SCr_adj
ae_date       ~l_date_date  temp_immun~e  creatinine    cpnsd~r_date  min
cpnsd~h_date  hba1c~l_date  temp_immun~f  diabetes_t~e  onsconfirm..  max
ethni~6_date  hba1c_perc..  died_ons_c..  diabetes_e~s  carehometype  diabcat
ethni~y_date  crea~te_date  d~nfirmedc~y  diabetes_e~r  bmi_time
bmi_measured  crea~ne_date  died_ons_s~y  index         bmi_age

. drop `r(varlist)'

.         
. 
. /* APPLY INCLUSION/EXCLUIONS==================================================*/ 
. 
. safecount
  79,060

. 
. noi di "DROP AGE >110:"
DROP AGE >110:

. drop if age > 110 & age != .
(0 observations deleted)

. 
. safecount
  79,060

. noi di "DROP IF DIED BEFORE INDEX"
DROP IF DIED BEFORE INDEX

. 
. *fix death dates
. drop if onsdeath_date <= indexdate
(0 observations deleted)

. safecount 
  79,060

. 
. sort patient_id

. save ./output/analysis_dataset.dta, replace
file ./output/analysis_dataset.dta saved

. 
. /****************************************************************
> *  Create outcome specific datasets for the whole population  *
> *****************************************************************
> 
> 
> foreach i of global outcomes {
>         use ./output/analysis_dataset.dta, clear
>         drop if `i'_date <= indexdate 
>         stset stime_`i', fail(`i')                              ///     
>         id(patient_id) enter(indexdate) origin(indexdate)
>         save ./output/analysis_dataset_STSET_`i'.dta, replace
> }       
> 
> 
>         
> * Close log file 
> log close
> */
. 
end of do-file

. do "/Users/lsh152058/Documents/GitHub/Ethnicity-2nd-wave/analysis/01e_eth_cr_stset
> _icu.do"

. /*==============================================================================
> DO FILE NAME:                   01b_eth_cr_stset_icu
> PROJECT:                                Ethnicity 2nd Wave
> DATE:                                   6th Jan 2020
> AUTHOR:                                 Rohini Mathur                             
>                               
> DESCRIPTION OF FILE:    program 01, data management for project  
>                                                 reformat variables 
>                                                 categorise variables
>                                                 label variables 
>                                                 apply exclusion criteria
> DATASETS USED:                  data in memory (from analysis/input.csv)
> DATASETS CREATED:               none
> OTHER OUTPUT:                   logfiles, printed to folder analysis/$logdir
> 
> 
>                                                         
> ==============================================================================*/
. 
. * Open a log file
. cap log close
